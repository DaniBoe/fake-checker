"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/check";
exports.ids = ["pages/api/check"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "busboy":
/*!*************************!*\
  !*** external "busboy" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("busboy");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

module.exports = import("zod");;

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcheck&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccheck.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcheck&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccheck.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_check_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\check.ts */ \"(api)/./pages/api/check.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_check_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_check_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_check_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_check_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/check\",\n        pathname: \"/api/check\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_check_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNoZWNrJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNjaGVjay50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNtRDtBQUNuRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsZ0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLGdEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2xhYnVidXMtY2hlY2tlci8/OGQzMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGNoZWNrLnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2hlY2tcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGVja1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcheck&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccheck.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/classifier.ts":
/*!***************************!*\
  !*** ./lib/classifier.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   callImageClassifier: () => (/* binding */ callImageClassifier)\n/* harmony export */ });\nconst KNOWN_BRANDS = [\n    \"LabCo\",\n    \"LabuPrime\",\n    \"VeritasLab\"\n];\nasync function heuristicMock(imageUrl, meta) {\n    const lower = imageUrl.toLowerCase();\n    if (lower.includes(\"fake\")) {\n        return {\n            label: \"Fake\",\n            reason: \"Filename hints fake; visual artifacts likely.\",\n            confidence: 0.92\n        };\n    }\n    if (meta?.brand && KNOWN_BRANDS.includes(meta.brand)) {\n        return {\n            label: \"Likely Authentic\",\n            reason: `Known brand match (${meta.brand}). No obvious anomalies.`,\n            confidence: 0.78\n        };\n    }\n    const hash = Array.from(lower).reduce((a, c)=>a + c.charCodeAt(0), 0);\n    const r = hash % 100 / 100;\n    if (r < 0.33) return {\n        label: \"Likely Authentic\",\n        reason: \"Consistent texture and logo placement.\",\n        confidence: 0.71\n    };\n    if (r < 0.66) return {\n        label: \"Suspicious\",\n        reason: \"Inconsistent stitching and color cast.\",\n        confidence: 0.64\n    };\n    return {\n        label: \"Fake\",\n        reason: \"Logo mismatch and seam artifacts detected.\",\n        confidence: 0.83\n    };\n}\nconst LABUBU_SYSTEM_PROMPT = [\n    \"You are an expert in authenticating Pop Mart’s Labubu figures.\",\n    \"Your job is to analyze only the provided image(s) of a Labubu and determine whether it is Likely Authentic, Suspicious, or Likely Fake.\",\n    \"What to look for (from image only):\",\n    \"Teeth: exactly nine pointed teeth, evenly spaced; paint cleanly separated from the mouth’s blue line; flag sloppy/merged teeth or wrong count.\",\n    \"Face & Eyes: pale peach (not overly orange/yellow/pink); smooth matte with subtle blush; eyes glossy/glass-like with natural reflections; flag dull/flat eyes, sloppy paint, or unnatural protrusion.\",\n    \"Ears & Hairline: ears close together and slightly inward; hairline at a natural position; fakes often show ears too upright/far apart or hairline too high.\",\n    \"Fur & Stitching (plush): fur should look soft/high-quality; stitching clean and blending with vinyl face; flag coarse fur, frayed threads, uneven seams.\",\n    \"Body Shape & Proportions: look for proportional body without warped faces/lopsided heads; flag misshapen or incorrect proportions.\",\n    \"Foot Details: left foot with Pop Mart logo; right foot (2024+) may have a UV stamp—if not visible, do not penalize; only note absence.\",\n    \"Paint & Overall Quality: crisp paint lines, no chipping/overspray; flag sloppy work or mismatched colors.\",\n    \"Packaging (if visible): clean print, correct logos, consistent palette; matte box finish where appropriate; tags/cards look professionally printed and match known designs.\",\n    'Output format (STRICT JSON only): {\"label\":\"Likely Authentic|Suspicious|Fake\",\"reason\":\"short explanation citing observed features\",\"confidence\":0..1}.',\n    \"If the image is insufficient for confidence, choose 'Suspicious' and state what is unclear/missing. Use factual, collector‑friendly language and probability terms (likely authentic/fake).\"\n].join(\" \");\n// TODO: replace or enhance this with your preferred model provider\nasync function callImageClassifier(imageUrl, meta) {\n    const apiKey = process.env.OPENAI_API_KEY;\n    if (!apiKey) {\n        console.log(`[classifier] OPENAI_API_KEY missing; using heuristic fallback`);\n        return heuristicMock(imageUrl, meta);\n    }\n    try {\n        const OpenAI = (await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! openai */ \"openai\"))).default;\n        const client = new OpenAI({\n            apiKey\n        });\n        const system = LABUBU_SYSTEM_PROMPT;\n        const userParts = [];\n        if (meta?.analysisPrompt) {\n            userParts.push({\n                type: \"text\",\n                text: `Inspection prompt: ${meta.analysisPrompt}`\n            });\n        }\n        if (meta) {\n            const { analysisPrompt, ...rest } = meta;\n            if (Object.keys(rest).length) {\n                userParts.push({\n                    type: \"text\",\n                    text: `Metadata: ${JSON.stringify(rest)}`\n                });\n            }\n        }\n        userParts.push({\n            type: \"image_url\",\n            image_url: {\n                url: imageUrl\n            }\n        });\n        const response = await client.chat.completions.create({\n            model: process.env.OPENAI_VISION_MODEL || \"gpt-4o-mini\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: system\n                },\n                {\n                    role: \"user\",\n                    content: userParts\n                }\n            ],\n            temperature: 0.2,\n            response_format: {\n                type: \"json_object\"\n            }\n        });\n        console.log(`[classifier] OpenAI call succeeded (model=${process.env.OPENAI_VISION_MODEL || \"gpt-4o-mini\"})`);\n        const text = response.choices?.[0]?.message?.content || \"\";\n        try {\n            const parsed = JSON.parse(text);\n            const label = parsed.label;\n            const reason = String(parsed.reason || \"\");\n            const confidence = Math.max(0, Math.min(1, Number(parsed.confidence ?? 0.7)));\n            if (label === \"Likely Authentic\" || label === \"Suspicious\" || label === \"Fake\") {\n                return {\n                    label,\n                    reason,\n                    confidence\n                };\n            }\n        } catch  {}\n        const lowered = text.toLowerCase();\n        if (lowered.includes(\"fake\")) return {\n            label: \"Fake\",\n            reason: text.slice(0, 200),\n            confidence: 0.8\n        };\n        if (lowered.includes(\"authentic\")) return {\n            label: \"Likely Authentic\",\n            reason: text.slice(0, 200),\n            confidence: 0.7\n        };\n        return {\n            label: \"Suspicious\",\n            reason: text.slice(0, 200) || \"Ambiguous assessment.\",\n            confidence: 0.6\n        };\n    } catch (err) {\n        console.log(`[classifier] OpenAI call failed; using heuristic fallback`, err instanceof Error ? err.message : err);\n        return heuristicMock(imageUrl, meta);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU9sRSxjQUFjQyxVQUFVQztJQUNoQztBQUNEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGFidWJ1cy1jaGVja2VyLy4vbGliL2NsYXNzaWZpZXIudHM/ZWM3YiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgdHlwZSBDbGFzc2lmaWNhdGlvbiA9IHtcblx0bGFiZWw6IFwiTGlrZWx5IEF1dGhlbnRpY1wiIHwgXCJTdXNwaWNpb3VzXCIgfCBcIkZha2VcIjtcblx0cmVhc29uOiBzdHJpbmc7XG5cdGNvbmZpZGVuY2U6IG51bWJlcjsgLy8gMC4uMVxufTtcblxuY29uc3QgS05PV05fQlJBTkRTID0gW1wiTGFiQ29cIiwgXCJMYWJ1UHJpbWVcIiwgXCJWZXJpdGFzTGFiXCJdO1xuXG5hc3luYyBmdW5jdGlvbiBoZXVyaXN0aWNNb2NrKGltYWdlVXJsOiBzdHJpbmcsIG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogUHJvbWlzZTxDbGFzc2lmaWNhdGlvbj4ge1xuXHRjb25zdCBsb3dlciA9IGltYWdlVXJsLnRvTG93ZXJDYXNlKCk7XG5cdGlmIChsb3dlci5pbmNsdWRlcyhcImZha2VcIikpIHtcblx0XHRyZXR1cm4geyBsYWJlbDogXCJGYWtlXCIsIHJlYXNvbjogXCJGaWxlbmFtZSBoaW50cyBmYWtlOyB2aXN1YWwgYXJ0aWZhY3RzIGxpa2VseS5cIiwgY29uZmlkZW5jZTogMC45MiB9O1xuXHR9XG5cdGlmIChtZXRhPy5icmFuZCAmJiBLTk9XTl9CUkFORFMuaW5jbHVkZXMobWV0YS5icmFuZCkpIHtcblx0XHRyZXR1cm4geyBsYWJlbDogXCJMaWtlbHkgQXV0aGVudGljXCIsIHJlYXNvbjogYEtub3duIGJyYW5kIG1hdGNoICgke21ldGEuYnJhbmR9KS4gTm8gb2J2aW91cyBhbm9tYWxpZXMuYCwgY29uZmlkZW5jZTogMC43OCB9O1xuXHR9XG5cdGNvbnN0IGhhc2ggPSBBcnJheS5mcm9tKGxvd2VyKS5yZWR1Y2UoKGEsIGMpID0+IGEgKyBjLmNoYXJDb2RlQXQoMCksIDApO1xuXHRjb25zdCByID0gKGhhc2ggJSAxMDApIC8gMTAwO1xuXHRpZiAociA8IDAuMzMpIHJldHVybiB7IGxhYmVsOiBcIkxpa2VseSBBdXRoZW50aWNcIiwgcmVhc29uOiBcIkNvbnNpc3RlbnQgdGV4dHVyZSBhbmQgbG9nbyBwbGFjZW1lbnQuXCIsIGNvbmZpZGVuY2U6IDAuNzEgfTtcblx0aWYgKHIgPCAwLjY2KSByZXR1cm4geyBsYWJlbDogXCJTdXNwaWNpb3VzXCIsIHJlYXNvbjogXCJJbmNvbnNpc3RlbnQgc3RpdGNoaW5nIGFuZCBjb2xvciBjYXN0LlwiLCBjb25maWRlbmNlOiAwLjY0IH07XG5cdHJldHVybiB7IGxhYmVsOiBcIkZha2VcIiwgcmVhc29uOiBcIkxvZ28gbWlzbWF0Y2ggYW5kIHNlYW0gYXJ0aWZhY3RzIGRldGVjdGVkLlwiLCBjb25maWRlbmNlOiAwLjgzIH07XG59XG5cbmNvbnN0IExBQlVCVV9TWVNURU1fUFJPTVBUID0gW1xuXHRcIllvdSBhcmUgYW4gZXhwZXJ0IGluIGF1dGhlbnRpY2F0aW5nIFBvcCBNYXJ04oCZcyBMYWJ1YnUgZmlndXJlcy5cIixcblx0XCJZb3VyIGpvYiBpcyB0byBhbmFseXplIG9ubHkgdGhlIHByb3ZpZGVkIGltYWdlKHMpIG9mIGEgTGFidWJ1IGFuZCBkZXRlcm1pbmUgd2hldGhlciBpdCBpcyBMaWtlbHkgQXV0aGVudGljLCBTdXNwaWNpb3VzLCBvciBMaWtlbHkgRmFrZS5cIixcblx0XCJXaGF0IHRvIGxvb2sgZm9yIChmcm9tIGltYWdlIG9ubHkpOlwiLFxuXHRcIlRlZXRoOiBleGFjdGx5IG5pbmUgcG9pbnRlZCB0ZWV0aCwgZXZlbmx5IHNwYWNlZDsgcGFpbnQgY2xlYW5seSBzZXBhcmF0ZWQgZnJvbSB0aGUgbW91dGjigJlzIGJsdWUgbGluZTsgZmxhZyBzbG9wcHkvbWVyZ2VkIHRlZXRoIG9yIHdyb25nIGNvdW50LlwiLFxuXHRcIkZhY2UgJiBFeWVzOiBwYWxlIHBlYWNoIChub3Qgb3Zlcmx5IG9yYW5nZS95ZWxsb3cvcGluayk7IHNtb290aCBtYXR0ZSB3aXRoIHN1YnRsZSBibHVzaDsgZXllcyBnbG9zc3kvZ2xhc3MtbGlrZSB3aXRoIG5hdHVyYWwgcmVmbGVjdGlvbnM7IGZsYWcgZHVsbC9mbGF0IGV5ZXMsIHNsb3BweSBwYWludCwgb3IgdW5uYXR1cmFsIHByb3RydXNpb24uXCIsXG5cdFwiRWFycyAmIEhhaXJsaW5lOiBlYXJzIGNsb3NlIHRvZ2V0aGVyIGFuZCBzbGlnaHRseSBpbndhcmQ7IGhhaXJsaW5lIGF0IGEgbmF0dXJhbCBwb3NpdGlvbjsgZmFrZXMgb2Z0ZW4gc2hvdyBlYXJzIHRvbyB1cHJpZ2h0L2ZhciBhcGFydCBvciBoYWlybGluZSB0b28gaGlnaC5cIixcblx0XCJGdXIgJiBTdGl0Y2hpbmcgKHBsdXNoKTogZnVyIHNob3VsZCBsb29rIHNvZnQvaGlnaC1xdWFsaXR5OyBzdGl0Y2hpbmcgY2xlYW4gYW5kIGJsZW5kaW5nIHdpdGggdmlueWwgZmFjZTsgZmxhZyBjb2Fyc2UgZnVyLCBmcmF5ZWQgdGhyZWFkcywgdW5ldmVuIHNlYW1zLlwiLFxuXHRcIkJvZHkgU2hhcGUgJiBQcm9wb3J0aW9uczogbG9vayBmb3IgcHJvcG9ydGlvbmFsIGJvZHkgd2l0aG91dCB3YXJwZWQgZmFjZXMvbG9wc2lkZWQgaGVhZHM7IGZsYWcgbWlzc2hhcGVuIG9yIGluY29ycmVjdCBwcm9wb3J0aW9ucy5cIixcblx0XCJGb290IERldGFpbHM6IGxlZnQgZm9vdCB3aXRoIFBvcCBNYXJ0IGxvZ287IHJpZ2h0IGZvb3QgKDIwMjQrKSBtYXkgaGF2ZSBhIFVWIHN0YW1w4oCUaWYgbm90IHZpc2libGUsIGRvIG5vdCBwZW5hbGl6ZTsgb25seSBub3RlIGFic2VuY2UuXCIsXG5cdFwiUGFpbnQgJiBPdmVyYWxsIFF1YWxpdHk6IGNyaXNwIHBhaW50IGxpbmVzLCBubyBjaGlwcGluZy9vdmVyc3ByYXk7IGZsYWcgc2xvcHB5IHdvcmsgb3IgbWlzbWF0Y2hlZCBjb2xvcnMuXCIsXG5cdFwiUGFja2FnaW5nIChpZiB2aXNpYmxlKTogY2xlYW4gcHJpbnQsIGNvcnJlY3QgbG9nb3MsIGNvbnNpc3RlbnQgcGFsZXR0ZTsgbWF0dGUgYm94IGZpbmlzaCB3aGVyZSBhcHByb3ByaWF0ZTsgdGFncy9jYXJkcyBsb29rIHByb2Zlc3Npb25hbGx5IHByaW50ZWQgYW5kIG1hdGNoIGtub3duIGRlc2lnbnMuXCIsXG5cdFwiT3V0cHV0IGZvcm1hdCAoU1RSSUNUIEpTT04gb25seSk6IHtcXFwibGFiZWxcXFwiOlxcXCJMaWtlbHkgQXV0aGVudGljfFN1c3BpY2lvdXN8RmFrZVxcXCIsXFxcInJlYXNvblxcXCI6XFxcInNob3J0IGV4cGxhbmF0aW9uIGNpdGluZyBvYnNlcnZlZCBmZWF0dXJlc1xcXCIsXFxcImNvbmZpZGVuY2VcXFwiOjAuLjF9LlwiLFxuXHRcIklmIHRoZSBpbWFnZSBpcyBpbnN1ZmZpY2llbnQgZm9yIGNvbmZpZGVuY2UsIGNob29zZSAnU3VzcGljaW91cycgYW5kIHN0YXRlIHdoYXQgaXMgdW5jbGVhci9taXNzaW5nLiBVc2UgZmFjdHVhbCwgY29sbGVjdG9y4oCRZnJpZW5kbHkgbGFuZ3VhZ2UgYW5kIHByb2JhYmlsaXR5IHRlcm1zIChsaWtlbHkgYXV0aGVudGljL2Zha2UpLlwiXG5dLmpvaW4oXCIgXCIpO1xuXG4vLyBUT0RPOiByZXBsYWNlIG9yIGVuaGFuY2UgdGhpcyB3aXRoIHlvdXIgcHJlZmVycmVkIG1vZGVsIHByb3ZpZGVyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2FsbEltYWdlQ2xhc3NpZmllcihpbWFnZVVybDogc3RyaW5nLCBtZXRhPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IFByb21pc2U8Q2xhc3NpZmljYXRpb24+IHtcblx0Y29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVk7XG5cdGlmICghYXBpS2V5KSB7XG5cdFx0Y29uc29sZS5sb2coYFtjbGFzc2lmaWVyXSBPUEVOQUlfQVBJX0tFWSBtaXNzaW5nOyB1c2luZyBoZXVyaXN0aWMgZmFsbGJhY2tgKTtcblx0XHRyZXR1cm4gaGV1cmlzdGljTW9jayhpbWFnZVVybCwgbWV0YSk7XG5cdH1cblxuXHR0cnkge1xuXHRcdGNvbnN0IE9wZW5BSSA9IChhd2FpdCBpbXBvcnQoXCJvcGVuYWlcIikpLmRlZmF1bHQ7XG5cdFx0Y29uc3QgY2xpZW50ID0gbmV3IE9wZW5BSSh7IGFwaUtleSB9KTtcblxuXHRcdGNvbnN0IHN5c3RlbSA9IExBQlVCVV9TWVNURU1fUFJPTVBUO1xuXG5cdFx0Y29uc3QgdXNlclBhcnRzOiBhbnlbXSA9IFtdO1xuXHRcdGlmIChtZXRhPy5hbmFseXNpc1Byb21wdCkge1xuXHRcdFx0dXNlclBhcnRzLnB1c2goeyB0eXBlOiBcInRleHRcIiwgdGV4dDogYEluc3BlY3Rpb24gcHJvbXB0OiAke21ldGEuYW5hbHlzaXNQcm9tcHR9YCB9KTtcblx0XHR9XG5cdFx0aWYgKG1ldGEpIHtcblx0XHRcdGNvbnN0IHsgYW5hbHlzaXNQcm9tcHQsIC4uLnJlc3QgfSA9IG1ldGE7XG5cdFx0XHRpZiAoT2JqZWN0LmtleXMocmVzdCkubGVuZ3RoKSB7XG5cdFx0XHRcdHVzZXJQYXJ0cy5wdXNoKHsgdHlwZTogXCJ0ZXh0XCIsIHRleHQ6IGBNZXRhZGF0YTogJHtKU09OLnN0cmluZ2lmeShyZXN0KX1gIH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0XHR1c2VyUGFydHMucHVzaCh7IHR5cGU6IFwiaW1hZ2VfdXJsXCIsIGltYWdlX3VybDogeyB1cmw6IGltYWdlVXJsIH0gfSk7XG5cblx0XHRjb25zdCByZXNwb25zZSA9IGF3YWl0IGNsaWVudC5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG5cdFx0XHRtb2RlbDogcHJvY2Vzcy5lbnYuT1BFTkFJX1ZJU0lPTl9NT0RFTCB8fCBcImdwdC00by1taW5pXCIsXG5cdFx0XHRtZXNzYWdlczogW1xuXHRcdFx0XHR7IHJvbGU6IFwic3lzdGVtXCIsIGNvbnRlbnQ6IHN5c3RlbSB9LFxuXHRcdFx0XHR7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiB1c2VyUGFydHMgYXMgYW55IH0sXG5cdFx0XHRdLFxuXHRcdFx0dGVtcGVyYXR1cmU6IDAuMixcblx0XHRcdHJlc3BvbnNlX2Zvcm1hdDogeyB0eXBlOiBcImpzb25fb2JqZWN0XCIgfVxuXHRcdH0pO1xuXHRcdGNvbnNvbGUubG9nKGBbY2xhc3NpZmllcl0gT3BlbkFJIGNhbGwgc3VjY2VlZGVkIChtb2RlbD0ke3Byb2Nlc3MuZW52Lk9QRU5BSV9WSVNJT05fTU9ERUwgfHwgXCJncHQtNG8tbWluaVwifSlgKTtcblx0XHRjb25zdCB0ZXh0ID0gcmVzcG9uc2UuY2hvaWNlcz8uWzBdPy5tZXNzYWdlPy5jb250ZW50IHx8IFwiXCI7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UodGV4dCk7XG5cdFx0XHRjb25zdCBsYWJlbCA9IHBhcnNlZC5sYWJlbCBhcyBDbGFzc2lmaWNhdGlvbltcImxhYmVsXCJdO1xuXHRcdFx0Y29uc3QgcmVhc29uID0gU3RyaW5nKHBhcnNlZC5yZWFzb24gfHwgXCJcIik7XG5cdFx0XHRjb25zdCBjb25maWRlbmNlID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgTnVtYmVyKHBhcnNlZC5jb25maWRlbmNlID8/IDAuNykpKTtcblx0XHRcdGlmIChsYWJlbCA9PT0gXCJMaWtlbHkgQXV0aGVudGljXCIgfHwgbGFiZWwgPT09IFwiU3VzcGljaW91c1wiIHx8IGxhYmVsID09PSBcIkZha2VcIikge1xuXHRcdFx0XHRyZXR1cm4geyBsYWJlbCwgcmVhc29uLCBjb25maWRlbmNlIH07XG5cdFx0XHR9XG5cdFx0fSBjYXRjaCB7fVxuXHRcdGNvbnN0IGxvd2VyZWQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG5cdFx0aWYgKGxvd2VyZWQuaW5jbHVkZXMoXCJmYWtlXCIpKSByZXR1cm4geyBsYWJlbDogXCJGYWtlXCIsIHJlYXNvbjogdGV4dC5zbGljZSgwLCAyMDApLCBjb25maWRlbmNlOiAwLjggfTtcblx0XHRpZiAobG93ZXJlZC5pbmNsdWRlcyhcImF1dGhlbnRpY1wiKSkgcmV0dXJuIHsgbGFiZWw6IFwiTGlrZWx5IEF1dGhlbnRpY1wiLCByZWFzb246IHRleHQuc2xpY2UoMCwgMjAwKSwgY29uZmlkZW5jZTogMC43IH07XG5cdFx0cmV0dXJuIHsgbGFiZWw6IFwiU3VzcGljaW91c1wiLCByZWFzb246IHRleHQuc2xpY2UoMCwgMjAwKSB8fCBcIkFtYmlndW91cyBhc3Nlc3NtZW50LlwiLCBjb25maWRlbmNlOiAwLjYgfTtcblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0Y29uc29sZS5sb2coYFtjbGFzc2lmaWVyXSBPcGVuQUkgY2FsbCBmYWlsZWQ7IHVzaW5nIGhldXJpc3RpYyBmYWxsYmFja2AsIGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiBlcnIpO1xuXHRcdHJldHVybiBoZXVyaXN0aWNNb2NrKGltYWdlVXJsLCBtZXRhKTtcblx0fVxufVxuIl0sIm5hbWVzIjpbIktOT1dOX0JSQU5EUyIsImhldXJpc3RpY01vY2siLCJpbWFnZVVybCIsIm1ldGEiLCJsb3dlciIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJsYWJlbCIsInJlYXNvbiIsImNvbmZpZGVuY2UiLCJicmFuZCIsImhhc2giLCJBcnJheSIsImZyb20iLCJyZWR1Y2UiLCJhIiwiYyIsImNoYXJDb2RlQXQiLCJyIiwiTEFCVUJVX1NZU1RFTV9QUk9NUFQiLCJqb2luIiwiY2FsbEltYWdlQ2xhc3NpZmllciIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImNvbnNvbGUiLCJsb2ciLCJPcGVuQUkiLCJkZWZhdWx0IiwiY2xpZW50Iiwic3lzdGVtIiwidXNlclBhcnRzIiwiYW5hbHlzaXNQcm9tcHQiLCJwdXNoIiwidHlwZSIsInRleHQiLCJyZXN0IiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbWFnZV91cmwiLCJ1cmwiLCJyZXNwb25zZSIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwiT1BFTkFJX1ZJU0lPTl9NT0RFTCIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJ0ZW1wZXJhdHVyZSIsInJlc3BvbnNlX2Zvcm1hdCIsImNob2ljZXMiLCJtZXNzYWdlIiwicGFyc2VkIiwicGFyc2UiLCJTdHJpbmciLCJNYXRoIiwibWF4IiwibWluIiwiTnVtYmVyIiwibG93ZXJlZCIsInNsaWNlIiwiZXJyIiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/classifier.ts\n");

/***/ }),

/***/ "(api)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createClient: () => (/* binding */ createClient),\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://cfyohvsacffjgzpjrywn.supabase.co\" || 0, \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmeW9odnNhY2Zmamd6cGpyeXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjEzNDMsImV4cCI6MjA3MDQzNzM0M30.RdZJp0Z041_fEyFN10c_dkAJ-nVaSmttovBhj36VrnA\" || 0);\n// Export createClient for the enhanced usage system\nconst createClient = ()=>(0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://cfyohvsacffjgzpjrywn.supabase.co\" || 0, process.env.SUPABASE_SERVICE_ROLE_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmeW9odnNhY2Zmamd6cGpyeXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjEzNDMsImV4cCI6MjA3MDQzNzM0M30.RdZJp0Z041_fEyFN10c_dkAJ-nVaSmttovBhj36VrnA\" || 0);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUE2RTtBQUV0RSxNQUFNRSxXQUFXRCxtRUFBb0JBLENBQzNDRSwwQ0FBb0MsSUFBSSxDQUFFLEVBQzFDQSxrTkFBeUMsSUFBSSxDQUFFLEVBQzlDO0FBRUYsb0RBQW9EO0FBQzdDLE1BQU1ILGVBQWUsSUFBTUMsbUVBQW9CQSxDQUNyREUsMENBQW9DLElBQUksQ0FBRSxFQUMxQ0EsUUFBUUMsR0FBRyxDQUFDRyx5QkFBeUIsSUFBSUosa05BQXlDLElBQUksQ0FBRSxFQUN2RiIsInNvdXJjZXMiOlsid2VicGFjazovL2xhYnVidXMtY2hlY2tlci8uL2xpYi9kYi50cz8xZGYwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCBhcyBjcmVhdGVTdXBhYmFzZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU3VwYWJhc2VDbGllbnQoXG5cdHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCBcIlwiLFxuXHRwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCBcIlwiXG4pO1xuXG4vLyBFeHBvcnQgY3JlYXRlQ2xpZW50IGZvciB0aGUgZW5oYW5jZWQgdXNhZ2Ugc3lzdGVtXG5leHBvcnQgY29uc3QgY3JlYXRlQ2xpZW50ID0gKCkgPT4gY3JlYXRlU3VwYWJhc2VDbGllbnQoXG5cdHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCBcIlwiLFxuXHRwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8IFwiXCJcbik7XG5cbmV4cG9ydCB0eXBlIEhpc3RvcnlJdGVtID0ge1xuXHRpZDogc3RyaW5nO1xuXHR1c2VyX2lkPzogc3RyaW5nIHwgbnVsbDtcblx0aW1hZ2VfdXJsOiBzdHJpbmc7XG5cdGxhYmVsOiBcIkxpa2VseSBBdXRoZW50aWNcIiB8IFwiU3VzcGljaW91c1wiIHwgXCJGYWtlXCI7XG5cdHJlYXNvbjogc3RyaW5nO1xuXHRjb25maWRlbmNlOiBudW1iZXI7XG5cdGNyZWF0ZWRfYXQ6IHN0cmluZztcbn07XG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwiY3JlYXRlU3VwYWJhc2VDbGllbnQiLCJzdXBhYmFzZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/db.ts\n");

/***/ }),

/***/ "(api)/./lib/usage-enhanced.ts":
/*!*******************************!*\
  !*** ./lib/usage-enhanced.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addPaidChecks: () => (/* binding */ addPaidChecks),\n/* harmony export */   checkRateLimit: () => (/* binding */ checkRateLimit),\n/* harmony export */   deductPaidCheck: () => (/* binding */ deductPaidCheck),\n/* harmony export */   detectAbuse: () => (/* binding */ detectAbuse),\n/* harmony export */   getClientFingerprint: () => (/* binding */ getClientFingerprint),\n/* harmony export */   getUsageStats: () => (/* binding */ getUsageStats),\n/* harmony export */   hashIP: () => (/* binding */ hashIP),\n/* harmony export */   hashUserAgent: () => (/* binding */ hashUserAgent),\n/* harmony export */   logUsage: () => (/* binding */ logUsage)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\n// Mock database for testing\nconst mockSupabase = {\n    from: (table)=>({\n            select: (columns = \"*\")=>({\n                    eq: (column, value)=>({\n                            gte: (column, value)=>({\n                                    single: ()=>Promise.resolve({\n                                            data: null,\n                                            error: null\n                                        }),\n                                    then: (callback)=>Promise.resolve(callback({\n                                            data: [],\n                                            error: null\n                                        }))\n                                }),\n                            then: (callback)=>Promise.resolve(callback({\n                                    data: [],\n                                    error: null\n                                }))\n                        }),\n                    gte: (column, value)=>({\n                            then: (callback)=>Promise.resolve(callback({\n                                    data: [],\n                                    error: null\n                                }))\n                        }),\n                    then: (callback)=>Promise.resolve(callback({\n                            data: [],\n                            error: null\n                        }))\n                }),\n            insert: (data)=>Promise.resolve({\n                    data: null,\n                    error: null\n                }),\n            update: (data)=>({\n                    eq: (column, value)=>({\n                            eq: (column, value)=>({\n                                    select: (columns)=>({\n                                            single: ()=>Promise.resolve({\n                                                    data: {\n                                                        remaining_checks: 5\n                                                    },\n                                                    error: null\n                                                })\n                                        })\n                                }),\n                            select: (columns)=>({\n                                    single: ()=>Promise.resolve({\n                                            data: {\n                                                remaining_checks: 5\n                                            },\n                                            error: null\n                                        })\n                                })\n                        }),\n                    select: (columns)=>({\n                            single: ()=>Promise.resolve({\n                                    data: {\n                                        remaining_checks: 5\n                                    },\n                                    error: null\n                                })\n                        })\n                }),\n            raw: (query)=>query\n        })\n};\n// Use mock database in test environment, real database otherwise\nfunction createClient() {\n    if (false) {}\n    // Import real database client\n    const { createClient: createRealClient } = __webpack_require__(/*! ./db */ \"(api)/./lib/db.ts\");\n    const client = createRealClient();\n    console.log(\"\\uD83D\\uDD27 Usage enhanced client created\");\n    return client;\n}\n// Privacy-compliant hashing for GDPR/CCPA compliance\n// These functions create one-way hashes that cannot be reversed to original IP/UA\nfunction hashIP(ip) {\n    // Hash IP with salt for privacy - cannot be reversed to original IP\n    const salt = process.env.IP_HASH_SALT || \"default-salt-change-in-production\";\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(ip + salt).digest(\"hex\").substring(0, 16);\n}\nfunction hashUserAgent(userAgent) {\n    // Hash user agent with salt for privacy - cannot be reversed to original UA\n    const salt = process.env.UA_HASH_SALT || \"default-salt-change-in-production\";\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(userAgent + salt).digest(\"hex\").substring(0, 16);\n}\nfunction getClientFingerprint(req) {\n    // Get real IP (considering proxies)\n    const ip = req.headers[\"x-forwarded-for\"]?.split(\",\")[0] || req.headers[\"x-real-ip\"] || req.connection?.remoteAddress || req.socket?.remoteAddress || \"127.0.0.1\";\n    const userAgent = req.headers[\"user-agent\"] || \"unknown\";\n    return {\n        ipHash: hashIP(ip),\n        uaHash: hashUserAgent(userAgent)\n    };\n}\nasync function getUsageStats(userId, ipHash, uaHash) {\n    const supabase = createClient();\n    const now = new Date();\n    // Calculate the start of the current week (Monday)\n    const weekStart = new Date(now);\n    const dayOfWeek = now.getDay();\n    const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Sunday = 0, so 6 days back to Monday\n    weekStart.setDate(now.getDate() - daysToMonday);\n    weekStart.setHours(0, 0, 0, 0);\n    console.log(\"Getting usage stats for:\", {\n        userId,\n        ipHash,\n        uaHash,\n        weekStart: weekStart.toISOString()\n    });\n    console.log(\"UserId type:\", typeof userId, \"Value:\", userId);\n    // Get free checks used in the current week\n    let freeUsageQuery = supabase.from(\"usage_logs\").select(\"*\").gte(\"created_at\", weekStart.toISOString());\n    if (userId) {\n        // For authenticated users, count only free checks for this user\n        freeUsageQuery = freeUsageQuery.eq(\"user_id\", userId).eq(\"check_type\", \"free\");\n    } else {\n        // For anonymous users, count all checks (they're all free)\n        freeUsageQuery = freeUsageQuery.is(\"user_id\", null);\n    }\n    const { data: freeUsage, error: freeError } = await freeUsageQuery;\n    if (freeError) {\n        console.error(\"Error fetching free usage:\", freeError);\n    }\n    console.log(\"Free usage data:\", freeUsage);\n    const freeChecksUsed = freeUsage?.length || 0;\n    // Get paid checks remaining for user\n    let paidChecksRemaining = 0;\n    if (userId) {\n        console.log(\"\\uD83D\\uDD0D Fetching paid checks for user:\", userId);\n        const { data: user, error: userError } = await supabase.from(\"profiles\").select(\"remaining_checks\").eq(\"id\", userId).single();\n        if (userError) {\n            console.error(\"Error fetching user profile for paid checks:\", userError);\n            // If profile doesn't exist, create it\n            if (userError.code === \"PGRST116\") {\n                console.log(\"\\uD83D\\uDD27 User profile not found, creating one...\");\n                const { error: createError } = await supabase.from(\"profiles\").insert({\n                    id: userId,\n                    remaining_checks: 0\n                });\n                if (createError) {\n                    console.error(\"Error creating user profile:\", createError);\n                } else {\n                    console.log(\"\\uD83D\\uDD27 User profile created successfully\");\n                }\n            }\n        } else {\n            console.log(\"\\uD83D\\uDD0D User profile data:\", user);\n        }\n        paidChecksRemaining = user?.remaining_checks || 0;\n        console.log(\"\\uD83D\\uDD0D Paid checks remaining:\", paidChecksRemaining);\n    }\n    // Get total checks this week (for abuse detection)\n    const { data: totalUsage } = await supabase.from(\"usage_logs\").select(\"*\").gte(\"created_at\", weekStart.toISOString());\n    const totalChecksThisWeek = totalUsage?.length || 0;\n    // Check if user is limited (3 free checks per week)\n    const isLimited = freeChecksUsed >= 3;\n    console.log(\"isLimited calculation:\", {\n        freeChecksUsed,\n        isLimited\n    });\n    const result = {\n        freeChecksUsed,\n        paidChecksRemaining,\n        totalChecksThisWeek,\n        isLimited\n    };\n    console.log(\"Usage stats result:\", result);\n    return result;\n}\nasync function logUsage(userId, ipHash, uaHash, checkType) {\n    const supabase = createClient();\n    const { data, error } = await supabase.from(\"usage_logs\").insert({\n        user_id: userId || null,\n        ip_hash: ipHash,\n        user_agent_hash: uaHash,\n        check_type: checkType\n    });\n    if (error) {\n        console.error(\"Failed to log usage:\", error);\n        throw new Error(`Failed to log usage: ${error.message}`);\n    }\n    console.log(\"Successfully logged usage:\", {\n        userId,\n        ipHash,\n        uaHash,\n        checkType\n    });\n}\nasync function checkRateLimit(identifier, action = \"check\") {\n    const supabase = createClient();\n    const now = new Date();\n    const windowStart = new Date(now.getTime() - 60 * 60 * 1000); // 1 hour window\n    // Check current rate limit\n    const { data: existing } = await supabase.from(\"rate_limits\").select(\"*\").eq(\"identifier\", identifier).eq(\"action\", action).gte(\"window_start\", windowStart.toISOString()).single();\n    if (existing) {\n        // If more than 100 checks per hour, block (increased for testing)\n        if (existing.count >= 100) {\n            return false;\n        }\n        // Increment count\n        await supabase.from(\"rate_limits\").update({\n            count: existing.count + 1\n        }).eq(\"id\", existing.id);\n    } else {\n        // Create new rate limit record\n        await supabase.from(\"rate_limits\").insert({\n            identifier,\n            action,\n            count: 1,\n            window_start: now.toISOString()\n        });\n    }\n    return true;\n}\nasync function detectAbuse(ipHash, uaHash) {\n    const supabase = createClient();\n    const now = new Date();\n    // Calculate the start of the current week (Monday)\n    const weekStart = new Date(now);\n    const dayOfWeek = now.getDay();\n    const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Sunday = 0, so 6 days back to Monday\n    weekStart.setDate(now.getDate() - daysToMonday);\n    weekStart.setHours(0, 0, 0, 0);\n    // Check for suspicious activity patterns\n    const { data: ipUsage } = await supabase.from(\"usage_logs\").select(\"*\").eq(\"ip_hash\", ipHash).gte(\"created_at\", weekStart.toISOString());\n    const { data: uaUsage } = await supabase.from(\"usage_logs\").select(\"*\").eq(\"user_agent_hash\", uaHash).gte(\"created_at\", weekStart.toISOString());\n    // Flag as abuse if:\n    // - More than 50 checks from same IP this week (increased from daily limit)\n    // - More than 40 checks from same user agent this week (increased from daily limit)\n    // - More than 10 different user agents from same IP this week (increased from daily limit)\n    const ipCount = ipUsage?.length || 0;\n    const uaCount = uaUsage?.length || 0;\n    // Get unique user agents for this IP\n    const { data: uniqueUAs } = await supabase.from(\"usage_logs\").select(\"user_agent_hash\").eq(\"ip_hash\", ipHash).gte(\"created_at\", weekStart.toISOString());\n    const uniqueUACount = new Set(uniqueUAs?.map((u)=>u.user_agent_hash) || []).size;\n    return ipCount > 50 || uaCount > 40 || uniqueUACount > 10;\n}\nasync function deductPaidCheck(userId) {\n    const supabase = createClient();\n    console.log(\"\\uD83D\\uDD27 Deducting paid check for user:\", userId);\n    // First get current remaining_checks\n    const { data: currentProfile, error: fetchError } = await supabase.from(\"profiles\").select(\"remaining_checks\").eq(\"id\", userId).single();\n    if (fetchError) {\n        console.error(\"Error fetching current profile for deduction:\", fetchError);\n        return false;\n    }\n    const currentChecks = currentProfile?.remaining_checks || 0;\n    console.log(\"\\uD83D\\uDD27 Current checks before deduction:\", currentChecks);\n    if (currentChecks <= 0) {\n        console.log(\"\\uD83D\\uDD27 No checks remaining, cannot deduct\");\n        return false;\n    }\n    const newChecks = currentChecks - 1;\n    console.log(\"\\uD83D\\uDD27 Deducting check, new count will be:\", newChecks);\n    // Update with new value\n    const { data, error } = await supabase.from(\"profiles\").update({\n        remaining_checks: newChecks\n    }).eq(\"id\", userId).select(\"remaining_checks\").single();\n    if (error) {\n        console.error(\"Error deducting paid check:\", error);\n        return false;\n    }\n    console.log(\"\\uD83D\\uDD27 Successfully deducted check, new count:\", data?.remaining_checks);\n    return true;\n}\nasync function addPaidChecks(userId, checksToAdd) {\n    const supabase = createClient();\n    // First get current remaining_checks\n    const { data: currentProfile, error: fetchError } = await supabase.from(\"profiles\").select(\"remaining_checks\").eq(\"id\", userId).single();\n    if (fetchError) {\n        console.error(\"Error fetching current profile for addition:\", fetchError);\n        throw new Error(\"Failed to fetch current profile\");\n    }\n    const currentChecks = currentProfile?.remaining_checks || 0;\n    const newChecks = currentChecks + checksToAdd;\n    // Update with new value\n    const { error } = await supabase.from(\"profiles\").update({\n        remaining_checks: newChecks\n    }).eq(\"id\", userId);\n    if (error) {\n        console.error(\"Error adding paid checks:\", error);\n        throw new Error(\"Failed to add paid checks\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFNBQ3JCakQsSUFBSSxDQUFDLFlBQ0xnQixNQUFNLENBQUM7UUFBRUMsa0JBQWtCMEY7SUFBVSxHQUNyQ3ZHLEVBQUUsQ0FBQyxNQUFNNEM7SUFFWixJQUFJcEMsT0FBTztRQUNUYSxRQUFRYixLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxNQUFNLElBQUlzRSxNQUFNO0lBQ2xCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9sYWJ1YnVzLWNoZWNrZXIvLi9saWIvdXNhZ2UtZW5oYW5jZWQudHM/MTMxMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5cbi8vIE1vY2sgZGF0YWJhc2UgZm9yIHRlc3RpbmdcbmNvbnN0IG1vY2tTdXBhYmFzZSA9IHtcbiAgZnJvbTogKHRhYmxlOiBzdHJpbmcpID0+ICh7XG4gICAgc2VsZWN0OiAoY29sdW1uczogc3RyaW5nID0gJyonKSA9PiAoe1xuICAgICAgZXE6IChjb2x1bW46IHN0cmluZywgdmFsdWU6IGFueSkgPT4gKHtcbiAgICAgICAgZ3RlOiAoY29sdW1uOiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+ICh7XG4gICAgICAgICAgc2luZ2xlOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSxcbiAgICAgICAgICB0aGVuOiAoY2FsbGJhY2s6IGFueSkgPT4gUHJvbWlzZS5yZXNvbHZlKGNhbGxiYWNrKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pKVxuICAgICAgICB9KSxcbiAgICAgICAgdGhlbjogKGNhbGxiYWNrOiBhbnkpID0+IFByb21pc2UucmVzb2x2ZShjYWxsYmFjayh7IGRhdGE6IFtdLCBlcnJvcjogbnVsbCB9KSlcbiAgICAgIH0pLFxuICAgICAgZ3RlOiAoY29sdW1uOiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+ICh7XG4gICAgICAgIHRoZW46IChjYWxsYmFjazogYW55KSA9PiBQcm9taXNlLnJlc29sdmUoY2FsbGJhY2soeyBkYXRhOiBbXSwgZXJyb3I6IG51bGwgfSkpXG4gICAgICB9KSxcbiAgICAgIHRoZW46IChjYWxsYmFjazogYW55KSA9PiBQcm9taXNlLnJlc29sdmUoY2FsbGJhY2soeyBkYXRhOiBbXSwgZXJyb3I6IG51bGwgfSkpXG4gICAgfSksXG4gICAgaW5zZXJ0OiAoZGF0YTogYW55KSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSxcbiAgICB1cGRhdGU6IChkYXRhOiBhbnkpID0+ICh7XG4gICAgICBlcTogKGNvbHVtbjogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiAoe1xuICAgICAgICBlcTogKGNvbHVtbjogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiAoe1xuICAgICAgICAgIHNlbGVjdDogKGNvbHVtbnM6IHN0cmluZykgPT4gKHtcbiAgICAgICAgICAgIHNpbmdsZTogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogeyByZW1haW5pbmdfY2hlY2tzOiA1IH0sIGVycm9yOiBudWxsIH0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfSksXG4gICAgICAgIHNlbGVjdDogKGNvbHVtbnM6IHN0cmluZykgPT4gKHtcbiAgICAgICAgICBzaW5nbGU6ICgpID0+IFByb21pc2UucmVzb2x2ZSh7IGRhdGE6IHsgcmVtYWluaW5nX2NoZWNrczogNSB9LCBlcnJvcjogbnVsbCB9KVxuICAgICAgICB9KVxuICAgICAgfSksXG4gICAgICBzZWxlY3Q6IChjb2x1bW5zOiBzdHJpbmcpID0+ICh7XG4gICAgICAgIHNpbmdsZTogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogeyByZW1haW5pbmdfY2hlY2tzOiA1IH0sIGVycm9yOiBudWxsIH0pXG4gICAgICB9KVxuICAgIH0pLFxuICAgIHJhdzogKHF1ZXJ5OiBzdHJpbmcpID0+IHF1ZXJ5XG4gIH0pXG59O1xuXG4vLyBVc2UgbW9jayBkYXRhYmFzZSBpbiB0ZXN0IGVudmlyb25tZW50LCByZWFsIGRhdGFiYXNlIG90aGVyd2lzZVxuZnVuY3Rpb24gY3JlYXRlQ2xpZW50KCkge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xuICAgIHJldHVybiBtb2NrU3VwYWJhc2U7XG4gIH1cbiAgXG4gIC8vIEltcG9ydCByZWFsIGRhdGFiYXNlIGNsaWVudFxuICBjb25zdCB7IGNyZWF0ZUNsaWVudDogY3JlYXRlUmVhbENsaWVudCB9ID0gcmVxdWlyZSgnLi9kYicpO1xuICBjb25zdCBjbGllbnQgPSBjcmVhdGVSZWFsQ2xpZW50KCk7XG4gIGNvbnNvbGUubG9nKCfwn5SnIFVzYWdlIGVuaGFuY2VkIGNsaWVudCBjcmVhdGVkJyk7XG4gIHJldHVybiBjbGllbnQ7XG59XG5cbi8vIFByaXZhY3ktY29tcGxpYW50IGhhc2hpbmcgZm9yIEdEUFIvQ0NQQSBjb21wbGlhbmNlXG4vLyBUaGVzZSBmdW5jdGlvbnMgY3JlYXRlIG9uZS13YXkgaGFzaGVzIHRoYXQgY2Fubm90IGJlIHJldmVyc2VkIHRvIG9yaWdpbmFsIElQL1VBXG5leHBvcnQgZnVuY3Rpb24gaGFzaElQKGlwOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBIYXNoIElQIHdpdGggc2FsdCBmb3IgcHJpdmFjeSAtIGNhbm5vdCBiZSByZXZlcnNlZCB0byBvcmlnaW5hbCBJUFxuICBjb25zdCBzYWx0ID0gcHJvY2Vzcy5lbnYuSVBfSEFTSF9TQUxUIHx8ICdkZWZhdWx0LXNhbHQtY2hhbmdlLWluLXByb2R1Y3Rpb24nO1xuICByZXR1cm4gY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShpcCArIHNhbHQpLmRpZ2VzdCgnaGV4Jykuc3Vic3RyaW5nKDAsIDE2KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc2hVc2VyQWdlbnQodXNlckFnZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBIYXNoIHVzZXIgYWdlbnQgd2l0aCBzYWx0IGZvciBwcml2YWN5IC0gY2Fubm90IGJlIHJldmVyc2VkIHRvIG9yaWdpbmFsIFVBXG4gIGNvbnN0IHNhbHQgPSBwcm9jZXNzLmVudi5VQV9IQVNIX1NBTFQgfHwgJ2RlZmF1bHQtc2FsdC1jaGFuZ2UtaW4tcHJvZHVjdGlvbic7XG4gIHJldHVybiBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKHVzZXJBZ2VudCArIHNhbHQpLmRpZ2VzdCgnaGV4Jykuc3Vic3RyaW5nKDAsIDE2KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENsaWVudEZpbmdlcnByaW50KHJlcTogYW55KTogeyBpcEhhc2g6IHN0cmluZzsgdWFIYXNoOiBzdHJpbmcgfSB7XG4gIC8vIEdldCByZWFsIElQIChjb25zaWRlcmluZyBwcm94aWVzKVxuICBjb25zdCBpcCA9IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXT8uc3BsaXQoJywnKVswXSB8fCBcbiAgICAgICAgICAgICByZXEuaGVhZGVyc1sneC1yZWFsLWlwJ10gfHwgXG4gICAgICAgICAgICAgcmVxLmNvbm5lY3Rpb24/LnJlbW90ZUFkZHJlc3MgfHwgXG4gICAgICAgICAgICAgcmVxLnNvY2tldD8ucmVtb3RlQWRkcmVzcyB8fCBcbiAgICAgICAgICAgICAnMTI3LjAuMC4xJztcbiAgXG4gIGNvbnN0IHVzZXJBZ2VudCA9IHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J10gfHwgJ3Vua25vd24nO1xuICBcbiAgcmV0dXJuIHtcbiAgICBpcEhhc2g6IGhhc2hJUChpcCksXG4gICAgdWFIYXNoOiBoYXNoVXNlckFnZW50KHVzZXJBZ2VudClcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVc2FnZVN0YXRzIHtcbiAgZnJlZUNoZWNrc1VzZWQ6IG51bWJlcjtcbiAgcGFpZENoZWNrc1JlbWFpbmluZzogbnVtYmVyO1xuICB0b3RhbENoZWNrc1RoaXNXZWVrOiBudW1iZXI7XG4gIGlzTGltaXRlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzYWdlU3RhdHModXNlcklkPzogc3RyaW5nLCBpcEhhc2g/OiBzdHJpbmcsIHVhSGFzaD86IHN0cmluZyk6IFByb21pc2U8VXNhZ2VTdGF0cz4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudCgpO1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICBcbiAgLy8gQ2FsY3VsYXRlIHRoZSBzdGFydCBvZiB0aGUgY3VycmVudCB3ZWVrIChNb25kYXkpXG4gIGNvbnN0IHdlZWtTdGFydCA9IG5ldyBEYXRlKG5vdyk7XG4gIGNvbnN0IGRheU9mV2VlayA9IG5vdy5nZXREYXkoKTtcbiAgY29uc3QgZGF5c1RvTW9uZGF5ID0gZGF5T2ZXZWVrID09PSAwID8gNiA6IGRheU9mV2VlayAtIDE7IC8vIFN1bmRheSA9IDAsIHNvIDYgZGF5cyBiYWNrIHRvIE1vbmRheVxuICB3ZWVrU3RhcnQuc2V0RGF0ZShub3cuZ2V0RGF0ZSgpIC0gZGF5c1RvTW9uZGF5KTtcbiAgd2Vla1N0YXJ0LnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICBcbiAgY29uc29sZS5sb2coJ0dldHRpbmcgdXNhZ2Ugc3RhdHMgZm9yOicsIHsgdXNlcklkLCBpcEhhc2gsIHVhSGFzaCwgd2Vla1N0YXJ0OiB3ZWVrU3RhcnQudG9JU09TdHJpbmcoKSB9KTtcbiAgY29uc29sZS5sb2coJ1VzZXJJZCB0eXBlOicsIHR5cGVvZiB1c2VySWQsICdWYWx1ZTonLCB1c2VySWQpO1xuICBcbiAgLy8gR2V0IGZyZWUgY2hlY2tzIHVzZWQgaW4gdGhlIGN1cnJlbnQgd2Vla1xuICBsZXQgZnJlZVVzYWdlUXVlcnkgPSBzdXBhYmFzZVxuICAgIC5mcm9tKCd1c2FnZV9sb2dzJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZ3RlKCdjcmVhdGVkX2F0Jywgd2Vla1N0YXJ0LnRvSVNPU3RyaW5nKCkpO1xuICBcbiAgaWYgKHVzZXJJZCkge1xuICAgIC8vIEZvciBhdXRoZW50aWNhdGVkIHVzZXJzLCBjb3VudCBvbmx5IGZyZWUgY2hlY2tzIGZvciB0aGlzIHVzZXJcbiAgICBmcmVlVXNhZ2VRdWVyeSA9IGZyZWVVc2FnZVF1ZXJ5LmVxKCd1c2VyX2lkJywgdXNlcklkKS5lcSgnY2hlY2tfdHlwZScsICdmcmVlJyk7XG4gIH0gZWxzZSB7XG4gICAgLy8gRm9yIGFub255bW91cyB1c2VycywgY291bnQgYWxsIGNoZWNrcyAodGhleSdyZSBhbGwgZnJlZSlcbiAgICBmcmVlVXNhZ2VRdWVyeSA9IGZyZWVVc2FnZVF1ZXJ5LmlzKCd1c2VyX2lkJywgbnVsbCk7XG4gIH1cbiAgXG4gIGNvbnN0IHsgZGF0YTogZnJlZVVzYWdlLCBlcnJvcjogZnJlZUVycm9yIH0gPSBhd2FpdCBmcmVlVXNhZ2VRdWVyeTtcbiAgXG4gIGlmIChmcmVlRXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBmcmVlIHVzYWdlOicsIGZyZWVFcnJvcik7XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKCdGcmVlIHVzYWdlIGRhdGE6JywgZnJlZVVzYWdlKTtcbiAgY29uc3QgZnJlZUNoZWNrc1VzZWQgPSBmcmVlVXNhZ2U/Lmxlbmd0aCB8fCAwO1xuICBcbiAgLy8gR2V0IHBhaWQgY2hlY2tzIHJlbWFpbmluZyBmb3IgdXNlclxuICBsZXQgcGFpZENoZWNrc1JlbWFpbmluZyA9IDA7XG4gIGlmICh1c2VySWQpIHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBGZXRjaGluZyBwYWlkIGNoZWNrcyBmb3IgdXNlcjonLCB1c2VySWQpO1xuICAgIGNvbnN0IHsgZGF0YTogdXNlciwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAuc2VsZWN0KCdyZW1haW5pbmdfY2hlY2tzJylcbiAgICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgICAuc2luZ2xlKCk7XG4gICAgXG4gICAgaWYgKHVzZXJFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlciBwcm9maWxlIGZvciBwYWlkIGNoZWNrczonLCB1c2VyRXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBJZiBwcm9maWxlIGRvZXNuJ3QgZXhpc3QsIGNyZWF0ZSBpdFxuICAgICAgaWYgKHVzZXJFcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SnIFVzZXIgcHJvZmlsZSBub3QgZm91bmQsIGNyZWF0aW5nIG9uZS4uLicpO1xuICAgICAgICBjb25zdCB7IGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxuICAgICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIHJlbWFpbmluZ19jaGVja3M6IDBcbiAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChjcmVhdGVFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHVzZXIgcHJvZmlsZTonLCBjcmVhdGVFcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ/CflKcgVXNlciBwcm9maWxlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coJ/CflI0gVXNlciBwcm9maWxlIGRhdGE6JywgdXNlcik7XG4gICAgfVxuICAgIFxuICAgIHBhaWRDaGVja3NSZW1haW5pbmcgPSB1c2VyPy5yZW1haW5pbmdfY2hlY2tzIHx8IDA7XG4gICAgY29uc29sZS5sb2coJ/CflI0gUGFpZCBjaGVja3MgcmVtYWluaW5nOicsIHBhaWRDaGVja3NSZW1haW5pbmcpO1xuICB9XG4gIFxuICAvLyBHZXQgdG90YWwgY2hlY2tzIHRoaXMgd2VlayAoZm9yIGFidXNlIGRldGVjdGlvbilcbiAgY29uc3QgeyBkYXRhOiB0b3RhbFVzYWdlIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCd1c2FnZV9sb2dzJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZ3RlKCdjcmVhdGVkX2F0Jywgd2Vla1N0YXJ0LnRvSVNPU3RyaW5nKCkpO1xuICBcbiAgY29uc3QgdG90YWxDaGVja3NUaGlzV2VlayA9IHRvdGFsVXNhZ2U/Lmxlbmd0aCB8fCAwO1xuICBcbiAgLy8gQ2hlY2sgaWYgdXNlciBpcyBsaW1pdGVkICgzIGZyZWUgY2hlY2tzIHBlciB3ZWVrKVxuICBjb25zdCBpc0xpbWl0ZWQgPSBmcmVlQ2hlY2tzVXNlZCA+PSAzO1xuICBjb25zb2xlLmxvZygnaXNMaW1pdGVkIGNhbGN1bGF0aW9uOicsIHsgZnJlZUNoZWNrc1VzZWQsIGlzTGltaXRlZCB9KTtcbiAgXG4gIGNvbnN0IHJlc3VsdCA9IHtcbiAgICBmcmVlQ2hlY2tzVXNlZCxcbiAgICBwYWlkQ2hlY2tzUmVtYWluaW5nLFxuICAgIHRvdGFsQ2hlY2tzVGhpc1dlZWssXG4gICAgaXNMaW1pdGVkXG4gIH07XG4gIFxuICBjb25zb2xlLmxvZygnVXNhZ2Ugc3RhdHMgcmVzdWx0OicsIHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dVc2FnZShcbiAgdXNlcklkOiBzdHJpbmcgfCBudWxsLCBcbiAgaXBIYXNoOiBzdHJpbmcsIFxuICB1YUhhc2g6IHN0cmluZywgXG4gIGNoZWNrVHlwZTogJ2ZyZWUnIHwgJ3BhaWQnXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoKTtcbiAgXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3VzYWdlX2xvZ3MnKVxuICAgIC5pbnNlcnQoe1xuICAgICAgdXNlcl9pZDogdXNlcklkIHx8IG51bGwsXG4gICAgICBpcF9oYXNoOiBpcEhhc2gsXG4gICAgICB1c2VyX2FnZW50X2hhc2g6IHVhSGFzaCxcbiAgICAgIGNoZWNrX3R5cGU6IGNoZWNrVHlwZVxuICAgIH0pO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvZyB1c2FnZTonLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbG9nIHVzYWdlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKCdTdWNjZXNzZnVsbHkgbG9nZ2VkIHVzYWdlOicsIHsgdXNlcklkLCBpcEhhc2gsIHVhSGFzaCwgY2hlY2tUeXBlIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllcjogc3RyaW5nLCBhY3Rpb246IHN0cmluZyA9ICdjaGVjaycpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoKTtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3Qgd2luZG93U3RhcnQgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gNjAgKiA2MCAqIDEwMDApOyAvLyAxIGhvdXIgd2luZG93XG4gIFxuICAvLyBDaGVjayBjdXJyZW50IHJhdGUgbGltaXRcbiAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgncmF0ZV9saW1pdHMnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5lcSgnaWRlbnRpZmllcicsIGlkZW50aWZpZXIpXG4gICAgLmVxKCdhY3Rpb24nLCBhY3Rpb24pXG4gICAgLmd0ZSgnd2luZG93X3N0YXJ0Jywgd2luZG93U3RhcnQudG9JU09TdHJpbmcoKSlcbiAgICAuc2luZ2xlKCk7XG4gIFxuICBpZiAoZXhpc3RpbmcpIHtcbiAgICAvLyBJZiBtb3JlIHRoYW4gMTAwIGNoZWNrcyBwZXIgaG91ciwgYmxvY2sgKGluY3JlYXNlZCBmb3IgdGVzdGluZylcbiAgICBpZiAoZXhpc3RpbmcuY291bnQgPj0gMTAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIEluY3JlbWVudCBjb3VudFxuICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncmF0ZV9saW1pdHMnKVxuICAgICAgLnVwZGF0ZSh7IGNvdW50OiBleGlzdGluZy5jb3VudCArIDEgfSlcbiAgICAgIC5lcSgnaWQnLCBleGlzdGluZy5pZCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gQ3JlYXRlIG5ldyByYXRlIGxpbWl0IHJlY29yZFxuICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncmF0ZV9saW1pdHMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIGlkZW50aWZpZXIsXG4gICAgICAgIGFjdGlvbixcbiAgICAgICAgY291bnQ6IDEsXG4gICAgICAgIHdpbmRvd19zdGFydDogbm93LnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICB9XG4gIFxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRldGVjdEFidXNlKGlwSGFzaDogc3RyaW5nLCB1YUhhc2g6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudCgpO1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICBcbiAgLy8gQ2FsY3VsYXRlIHRoZSBzdGFydCBvZiB0aGUgY3VycmVudCB3ZWVrIChNb25kYXkpXG4gIGNvbnN0IHdlZWtTdGFydCA9IG5ldyBEYXRlKG5vdyk7XG4gIGNvbnN0IGRheU9mV2VlayA9IG5vdy5nZXREYXkoKTtcbiAgY29uc3QgZGF5c1RvTW9uZGF5ID0gZGF5T2ZXZWVrID09PSAwID8gNiA6IGRheU9mV2VlayAtIDE7IC8vIFN1bmRheSA9IDAsIHNvIDYgZGF5cyBiYWNrIHRvIE1vbmRheVxuICB3ZWVrU3RhcnQuc2V0RGF0ZShub3cuZ2V0RGF0ZSgpIC0gZGF5c1RvTW9uZGF5KTtcbiAgd2Vla1N0YXJ0LnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICBcbiAgLy8gQ2hlY2sgZm9yIHN1c3BpY2lvdXMgYWN0aXZpdHkgcGF0dGVybnNcbiAgY29uc3QgeyBkYXRhOiBpcFVzYWdlIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCd1c2FnZV9sb2dzJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZXEoJ2lwX2hhc2gnLCBpcEhhc2gpXG4gICAgLmd0ZSgnY3JlYXRlZF9hdCcsIHdlZWtTdGFydC50b0lTT1N0cmluZygpKTtcbiAgXG4gIGNvbnN0IHsgZGF0YTogdWFVc2FnZSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgndXNhZ2VfbG9ncycpXG4gICAgLnNlbGVjdCgnKicpXG4gICAgLmVxKCd1c2VyX2FnZW50X2hhc2gnLCB1YUhhc2gpXG4gICAgLmd0ZSgnY3JlYXRlZF9hdCcsIHdlZWtTdGFydC50b0lTT1N0cmluZygpKTtcbiAgXG4gIC8vIEZsYWcgYXMgYWJ1c2UgaWY6XG4gIC8vIC0gTW9yZSB0aGFuIDUwIGNoZWNrcyBmcm9tIHNhbWUgSVAgdGhpcyB3ZWVrIChpbmNyZWFzZWQgZnJvbSBkYWlseSBsaW1pdClcbiAgLy8gLSBNb3JlIHRoYW4gNDAgY2hlY2tzIGZyb20gc2FtZSB1c2VyIGFnZW50IHRoaXMgd2VlayAoaW5jcmVhc2VkIGZyb20gZGFpbHkgbGltaXQpXG4gIC8vIC0gTW9yZSB0aGFuIDEwIGRpZmZlcmVudCB1c2VyIGFnZW50cyBmcm9tIHNhbWUgSVAgdGhpcyB3ZWVrIChpbmNyZWFzZWQgZnJvbSBkYWlseSBsaW1pdClcbiAgY29uc3QgaXBDb3VudCA9IGlwVXNhZ2U/Lmxlbmd0aCB8fCAwO1xuICBjb25zdCB1YUNvdW50ID0gdWFVc2FnZT8ubGVuZ3RoIHx8IDA7XG4gIFxuICAvLyBHZXQgdW5pcXVlIHVzZXIgYWdlbnRzIGZvciB0aGlzIElQXG4gIGNvbnN0IHsgZGF0YTogdW5pcXVlVUFzIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCd1c2FnZV9sb2dzJylcbiAgICAuc2VsZWN0KCd1c2VyX2FnZW50X2hhc2gnKVxuICAgIC5lcSgnaXBfaGFzaCcsIGlwSGFzaClcbiAgICAuZ3RlKCdjcmVhdGVkX2F0Jywgd2Vla1N0YXJ0LnRvSVNPU3RyaW5nKCkpO1xuICBcbiAgY29uc3QgdW5pcXVlVUFDb3VudCA9IG5ldyBTZXQodW5pcXVlVUFzPy5tYXAodSA9PiB1LnVzZXJfYWdlbnRfaGFzaCkgfHwgW10pLnNpemU7XG4gIFxuICByZXR1cm4gaXBDb3VudCA+IDUwIHx8IHVhQ291bnQgPiA0MCB8fCB1bmlxdWVVQUNvdW50ID4gMTA7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWR1Y3RQYWlkQ2hlY2sodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoKTtcbiAgXG4gIGNvbnNvbGUubG9nKCfwn5SnIERlZHVjdGluZyBwYWlkIGNoZWNrIGZvciB1c2VyOicsIHVzZXJJZCk7XG4gIFxuICAvLyBGaXJzdCBnZXQgY3VycmVudCByZW1haW5pbmdfY2hlY2tzXG4gIGNvbnN0IHsgZGF0YTogY3VycmVudFByb2ZpbGUsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgLnNlbGVjdCgncmVtYWluaW5nX2NoZWNrcycpXG4gICAgLmVxKCdpZCcsIHVzZXJJZClcbiAgICAuc2luZ2xlKCk7XG4gIFxuICBpZiAoZmV0Y2hFcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGN1cnJlbnQgcHJvZmlsZSBmb3IgZGVkdWN0aW9uOicsIGZldGNoRXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgY29uc3QgY3VycmVudENoZWNrcyA9IGN1cnJlbnRQcm9maWxlPy5yZW1haW5pbmdfY2hlY2tzIHx8IDA7XG4gIGNvbnNvbGUubG9nKCfwn5SnIEN1cnJlbnQgY2hlY2tzIGJlZm9yZSBkZWR1Y3Rpb246JywgY3VycmVudENoZWNrcyk7XG4gIFxuICBpZiAoY3VycmVudENoZWNrcyA8PSAwKSB7XG4gICAgY29uc29sZS5sb2coJ/CflKcgTm8gY2hlY2tzIHJlbWFpbmluZywgY2Fubm90IGRlZHVjdCcpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgY29uc3QgbmV3Q2hlY2tzID0gY3VycmVudENoZWNrcyAtIDE7XG4gIGNvbnNvbGUubG9nKCfwn5SnIERlZHVjdGluZyBjaGVjaywgbmV3IGNvdW50IHdpbGwgYmU6JywgbmV3Q2hlY2tzKTtcbiAgXG4gIC8vIFVwZGF0ZSB3aXRoIG5ldyB2YWx1ZVxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgLnVwZGF0ZSh7IHJlbWFpbmluZ19jaGVja3M6IG5ld0NoZWNrcyB9KVxuICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgLnNlbGVjdCgncmVtYWluaW5nX2NoZWNrcycpXG4gICAgLnNpbmdsZSgpO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVkdWN0aW5nIHBhaWQgY2hlY2s6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgY29uc29sZS5sb2coJ/CflKcgU3VjY2Vzc2Z1bGx5IGRlZHVjdGVkIGNoZWNrLCBuZXcgY291bnQ6JywgZGF0YT8ucmVtYWluaW5nX2NoZWNrcyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWRkUGFpZENoZWNrcyh1c2VySWQ6IHN0cmluZywgY2hlY2tzVG9BZGQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudCgpO1xuICBcbiAgLy8gRmlyc3QgZ2V0IGN1cnJlbnQgcmVtYWluaW5nX2NoZWNrc1xuICBjb25zdCB7IGRhdGE6IGN1cnJlbnRQcm9maWxlLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgncHJvZmlsZXMnKVxuICAgIC5zZWxlY3QoJ3JlbWFpbmluZ19jaGVja3MnKVxuICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgLnNpbmdsZSgpO1xuICBcbiAgaWYgKGZldGNoRXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBjdXJyZW50IHByb2ZpbGUgZm9yIGFkZGl0aW9uOicsIGZldGNoRXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIGN1cnJlbnQgcHJvZmlsZScpO1xuICB9XG4gIFxuICBjb25zdCBjdXJyZW50Q2hlY2tzID0gY3VycmVudFByb2ZpbGU/LnJlbWFpbmluZ19jaGVja3MgfHwgMDtcbiAgY29uc3QgbmV3Q2hlY2tzID0gY3VycmVudENoZWNrcyArIGNoZWNrc1RvQWRkO1xuICBcbiAgLy8gVXBkYXRlIHdpdGggbmV3IHZhbHVlXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3Byb2ZpbGVzJylcbiAgICAudXBkYXRlKHsgcmVtYWluaW5nX2NoZWNrczogbmV3Q2hlY2tzIH0pXG4gICAgLmVxKCdpZCcsIHVzZXJJZCk7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhZGRpbmcgcGFpZCBjaGVja3M6JywgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGFkZCBwYWlkIGNoZWNrcycpO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJjcnlwdG8iLCJtb2NrU3VwYWJhc2UiLCJmcm9tIiwidGFibGUiLCJzZWxlY3QiLCJjb2x1bW5zIiwiZXEiLCJjb2x1bW4iLCJ2YWx1ZSIsImd0ZSIsInNpbmdsZSIsIlByb21pc2UiLCJyZXNvbHZlIiwiZGF0YSIsImVycm9yIiwidGhlbiIsImNhbGxiYWNrIiwiaW5zZXJ0IiwidXBkYXRlIiwicmVtYWluaW5nX2NoZWNrcyIsInJhdyIsInF1ZXJ5IiwiY3JlYXRlQ2xpZW50IiwicHJvY2VzcyIsImNyZWF0ZVJlYWxDbGllbnQiLCJyZXF1aXJlIiwiY2xpZW50IiwiY29uc29sZSIsImxvZyIsImhhc2hJUCIsImlwIiwic2FsdCIsImVudiIsIklQX0hBU0hfU0FMVCIsImNyZWF0ZUhhc2giLCJkaWdlc3QiLCJzdWJzdHJpbmciLCJoYXNoVXNlckFnZW50IiwidXNlckFnZW50IiwiVUFfSEFTSF9TQUxUIiwiZ2V0Q2xpZW50RmluZ2VycHJpbnQiLCJyZXEiLCJoZWFkZXJzIiwic3BsaXQiLCJjb25uZWN0aW9uIiwicmVtb3RlQWRkcmVzcyIsInNvY2tldCIsImlwSGFzaCIsInVhSGFzaCIsImdldFVzYWdlU3RhdHMiLCJ1c2VySWQiLCJzdXBhYmFzZSIsIm5vdyIsIkRhdGUiLCJ3ZWVrU3RhcnQiLCJkYXlPZldlZWsiLCJnZXREYXkiLCJkYXlzVG9Nb25kYXkiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInNldEhvdXJzIiwidG9JU09TdHJpbmciLCJmcmVlVXNhZ2VRdWVyeSIsImlzIiwiZnJlZVVzYWdlIiwiZnJlZUVycm9yIiwiZnJlZUNoZWNrc1VzZWQiLCJsZW5ndGgiLCJwYWlkQ2hlY2tzUmVtYWluaW5nIiwidXNlciIsInVzZXJFcnJvciIsImNvZGUiLCJjcmVhdGVFcnJvciIsImlkIiwidG90YWxVc2FnZSIsInRvdGFsQ2hlY2tzVGhpc1dlZWsiLCJpc0xpbWl0ZWQiLCJyZXN1bHQiLCJsb2dVc2FnZSIsImNoZWNrVHlwZSIsInVzZXJfaWQiLCJpcF9oYXNoIiwidXNlcl9hZ2VudF9oYXNoIiwiY2hlY2tfdHlwZSIsIkVycm9yIiwibWVzc2FnZSIsImNoZWNrUmF0ZUxpbWl0IiwiaWRlbnRpZmllciIsImFjdGlvbiIsIndpbmRvd1N0YXJ0IiwiZ2V0VGltZSIsImV4aXN0aW5nIiwiY291bnQiLCJ3aW5kb3dfc3RhcnQiLCJkZXRlY3RBYnVzZSIsImlwVXNhZ2UiLCJ1YVVzYWdlIiwiaXBDb3VudCIsInVhQ291bnQiLCJ1bmlxdWVVQXMiLCJ1bmlxdWVVQUNvdW50IiwiU2V0IiwibWFwIiwidSIsInNpemUiLCJkZWR1Y3RQYWlkQ2hlY2siLCJjdXJyZW50UHJvZmlsZSIsImZldGNoRXJyb3IiLCJjdXJyZW50Q2hlY2tzIiwibmV3Q2hlY2tzIiwiYWRkUGFpZENoZWNrcyIsImNoZWNrc1RvQWRkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/usage-enhanced.ts\n");

/***/ }),

/***/ "(api)/./lib/usage-node.ts":
/*!***************************!*\
  !*** ./lib/usage-node.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MAX_FREE: () => (/* binding */ MAX_FREE),\n/* harmony export */   WINDOW_MS: () => (/* binding */ WINDOW_MS),\n/* harmony export */   getAnonymousUsageFromCookie: () => (/* binding */ getAnonymousUsageFromCookie),\n/* harmony export */   isAnonymousLimitedFromCookie: () => (/* binding */ isAnonymousLimitedFromCookie),\n/* harmony export */   isFreemiumDisabled: () => (/* binding */ isFreemiumDisabled),\n/* harmony export */   makeSetCookieHeaderForAnonIncrement: () => (/* binding */ makeSetCookieHeaderForAnonIncrement),\n/* harmony export */   parseCookie: () => (/* binding */ parseCookie)\n/* harmony export */ });\nconst MAX_FREE = 3;\nconst WINDOW_MS = 24 * 60 * 60 * 1000;\nfunction isFreemiumDisabled() {\n    return process.env.DISABLE_FREEMIUM_LIMITS === \"true\";\n}\nfunction parseCookie(cookieHeader) {\n    const out = {};\n    if (!cookieHeader) return out;\n    cookieHeader.split(/;\\s*/).forEach((pair)=>{\n        const idx = pair.indexOf(\"=\");\n        if (idx > -1) {\n            const k = decodeURIComponent(pair.slice(0, idx));\n            const v = decodeURIComponent(pair.slice(idx + 1));\n            out[k] = v;\n        }\n    });\n    return out;\n}\nfunction getAnonymousUsageFromCookie(cookieHeader) {\n    const map = parseCookie(cookieHeader);\n    const raw = map[\"anon_checks_v1\"];\n    if (!raw) return {\n        timestamps: []\n    };\n    try {\n        const parsed = JSON.parse(raw);\n        return parsed;\n    } catch  {\n        return {\n            timestamps: []\n        };\n    }\n}\nfunction isAnonymousLimitedFromCookie(cookieHeader) {\n    if (isFreemiumDisabled()) return false;\n    const rec = getAnonymousUsageFromCookie(cookieHeader);\n    const now = Date.now();\n    const inWindow = rec.timestamps.filter((t)=>now - t < WINDOW_MS);\n    return inWindow.length >= MAX_FREE;\n}\nfunction makeSetCookieHeaderForAnonIncrement(cookieHeader) {\n    if (isFreemiumDisabled()) return undefined;\n    const rec = getAnonymousUsageFromCookie(cookieHeader);\n    const now = Date.now();\n    rec.timestamps = rec.timestamps.filter((t)=>now - t < WINDOW_MS);\n    rec.timestamps.push(now);\n    const value = encodeURIComponent(JSON.stringify(rec));\n    return `anon_checks_v1=${value}; Path=/; HttpOnly; SameSite=Lax; Max-Age=${60 * 60 * 24 * 7}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvdXNhZ2Utbm9kZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBRU8sTUFBTUEsV0FBVyxFQUFFO0FBQ25CLE1BQU1DLFlBQVksS0FBSyxLQUFLLEtBQUssS0FBSztBQUV0QyxTQUFTQztJQUNmLE9BQU9DLFFBQVFDLEdBQUcsQ0FBQ0MsdUJBQXVCLEtBQUs7QUFDaEQ7QUFFTyxTQUFTQyxZQUFZQyxZQUFxQjtJQUNoRCxNQUFNQyxNQUE4QixDQUFDO0lBQ3JDLElBQUksQ0FBQ0QsY0FBYyxPQUFPQztJQUMxQkQsYUFBYUUsS0FBSyxDQUFDLFFBQVFDLE9BQU8sQ0FBQyxDQUFDQztRQUNuQyxNQUFNQyxNQUFNRCxLQUFLRSxPQUFPLENBQUM7UUFDekIsSUFBSUQsTUFBTSxDQUFDLEdBQUc7WUFDYixNQUFNRSxJQUFJQyxtQkFBbUJKLEtBQUtLLEtBQUssQ0FBQyxHQUFHSjtZQUMzQyxNQUFNSyxJQUFJRixtQkFBbUJKLEtBQUtLLEtBQUssQ0FBQ0osTUFBTTtZQUM5Q0osR0FBRyxDQUFDTSxFQUFFLEdBQUdHO1FBQ1Y7SUFDRDtJQUNBLE9BQU9UO0FBQ1I7QUFFTyxTQUFTVSw0QkFBNEJYLFlBQXFCO0lBQ2hFLE1BQU1ZLE1BQU1iLFlBQVlDO0lBQ3hCLE1BQU1hLE1BQU1ELEdBQUcsQ0FBQyxpQkFBaUI7SUFDakMsSUFBSSxDQUFDQyxLQUFLLE9BQU87UUFBRUMsWUFBWSxFQUFFO0lBQUM7SUFDbEMsSUFBSTtRQUNILE1BQU1DLFNBQVNDLEtBQUtDLEtBQUssQ0FBQ0o7UUFDMUIsT0FBT0U7SUFDUixFQUFFLE9BQU07UUFDUCxPQUFPO1lBQUVELFlBQVksRUFBRTtRQUFDO0lBQ3pCO0FBQ0Q7QUFFTyxTQUFTSSw2QkFBNkJsQixZQUFxQjtJQUNqRSxJQUFJTCxzQkFBc0IsT0FBTztJQUNqQyxNQUFNd0IsTUFBTVIsNEJBQTRCWDtJQUN4QyxNQUFNb0IsTUFBTUMsS0FBS0QsR0FBRztJQUNwQixNQUFNRSxXQUFXSCxJQUFJTCxVQUFVLENBQUNTLE1BQU0sQ0FBQyxDQUFDQyxJQUFNSixNQUFNSSxJQUFJOUI7SUFDeEQsT0FBTzRCLFNBQVNHLE1BQU0sSUFBSWhDO0FBQzNCO0FBRU8sU0FBU2lDLG9DQUFvQzFCLFlBQXFCO0lBQ3hFLElBQUlMLHNCQUFzQixPQUFPZ0M7SUFDakMsTUFBTVIsTUFBTVIsNEJBQTRCWDtJQUN4QyxNQUFNb0IsTUFBTUMsS0FBS0QsR0FBRztJQUNwQkQsSUFBSUwsVUFBVSxHQUFHSyxJQUFJTCxVQUFVLENBQUNTLE1BQU0sQ0FBQyxDQUFDQyxJQUFNSixNQUFNSSxJQUFJOUI7SUFDeER5QixJQUFJTCxVQUFVLENBQUNjLElBQUksQ0FBQ1I7SUFDcEIsTUFBTVMsUUFBUUMsbUJBQW1CZCxLQUFLZSxTQUFTLENBQUNaO0lBQ2hELE9BQU8sQ0FBQyxlQUFlLEVBQUVVLE1BQU0sMENBQTBDLEVBQUUsS0FBSyxLQUFLLEtBQUssRUFBRSxDQUFDO0FBQzlGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGFidWJ1cy1jaGVja2VyLy4vbGliL3VzYWdlLW5vZGUudHM/Yjc5NCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgdHlwZSBDb3VudFJlY29yZCA9IHsgdGltZXN0YW1wczogbnVtYmVyW10gfTtcblxuZXhwb3J0IGNvbnN0IE1BWF9GUkVFID0gMztcbmV4cG9ydCBjb25zdCBXSU5ET1dfTVMgPSAyNCAqIDYwICogNjAgKiAxMDAwO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNGcmVlbWl1bURpc2FibGVkKCk6IGJvb2xlYW4ge1xuXHRyZXR1cm4gcHJvY2Vzcy5lbnYuRElTQUJMRV9GUkVFTUlVTV9MSU1JVFMgPT09ICd0cnVlJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQ29va2llKGNvb2tpZUhlYWRlcj86IHN0cmluZyk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuXHRjb25zdCBvdXQ6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcblx0aWYgKCFjb29raWVIZWFkZXIpIHJldHVybiBvdXQ7XG5cdGNvb2tpZUhlYWRlci5zcGxpdCgvO1xccyovKS5mb3JFYWNoKChwYWlyKSA9PiB7XG5cdFx0Y29uc3QgaWR4ID0gcGFpci5pbmRleE9mKCc9Jyk7XG5cdFx0aWYgKGlkeCA+IC0xKSB7XG5cdFx0XHRjb25zdCBrID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXIuc2xpY2UoMCwgaWR4KSk7XG5cdFx0XHRjb25zdCB2ID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXIuc2xpY2UoaWR4ICsgMSkpO1xuXHRcdFx0b3V0W2tdID0gdjtcblx0XHR9XG5cdH0pO1xuXHRyZXR1cm4gb3V0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QW5vbnltb3VzVXNhZ2VGcm9tQ29va2llKGNvb2tpZUhlYWRlcj86IHN0cmluZyk6IENvdW50UmVjb3JkIHtcblx0Y29uc3QgbWFwID0gcGFyc2VDb29raWUoY29va2llSGVhZGVyKTtcblx0Y29uc3QgcmF3ID0gbWFwW1wiYW5vbl9jaGVja3NfdjFcIl07XG5cdGlmICghcmF3KSByZXR1cm4geyB0aW1lc3RhbXBzOiBbXSB9O1xuXHR0cnkge1xuXHRcdGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UocmF3KSBhcyBDb3VudFJlY29yZDtcblx0XHRyZXR1cm4gcGFyc2VkO1xuXHR9IGNhdGNoIHtcblx0XHRyZXR1cm4geyB0aW1lc3RhbXBzOiBbXSB9O1xuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0Fub255bW91c0xpbWl0ZWRGcm9tQ29va2llKGNvb2tpZUhlYWRlcj86IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRpZiAoaXNGcmVlbWl1bURpc2FibGVkKCkpIHJldHVybiBmYWxzZTtcblx0Y29uc3QgcmVjID0gZ2V0QW5vbnltb3VzVXNhZ2VGcm9tQ29va2llKGNvb2tpZUhlYWRlcik7XG5cdGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cdGNvbnN0IGluV2luZG93ID0gcmVjLnRpbWVzdGFtcHMuZmlsdGVyKCh0KSA9PiBub3cgLSB0IDwgV0lORE9XX01TKTtcblx0cmV0dXJuIGluV2luZG93Lmxlbmd0aCA+PSBNQVhfRlJFRTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VTZXRDb29raWVIZWFkZXJGb3JBbm9uSW5jcmVtZW50KGNvb2tpZUhlYWRlcj86IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG5cdGlmIChpc0ZyZWVtaXVtRGlzYWJsZWQoKSkgcmV0dXJuIHVuZGVmaW5lZDtcblx0Y29uc3QgcmVjID0gZ2V0QW5vbnltb3VzVXNhZ2VGcm9tQ29va2llKGNvb2tpZUhlYWRlcik7XG5cdGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cdHJlYy50aW1lc3RhbXBzID0gcmVjLnRpbWVzdGFtcHMuZmlsdGVyKCh0KSA9PiBub3cgLSB0IDwgV0lORE9XX01TKTtcblx0cmVjLnRpbWVzdGFtcHMucHVzaChub3cpO1xuXHRjb25zdCB2YWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShyZWMpKTtcblx0cmV0dXJuIGBhbm9uX2NoZWNrc192MT0ke3ZhbHVlfTsgUGF0aD0vOyBIdHRwT25seTsgU2FtZVNpdGU9TGF4OyBNYXgtQWdlPSR7NjAgKiA2MCAqIDI0ICogN31gO1xufVxuIl0sIm5hbWVzIjpbIk1BWF9GUkVFIiwiV0lORE9XX01TIiwiaXNGcmVlbWl1bURpc2FibGVkIiwicHJvY2VzcyIsImVudiIsIkRJU0FCTEVfRlJFRU1JVU1fTElNSVRTIiwicGFyc2VDb29raWUiLCJjb29raWVIZWFkZXIiLCJvdXQiLCJzcGxpdCIsImZvckVhY2giLCJwYWlyIiwiaWR4IiwiaW5kZXhPZiIsImsiLCJkZWNvZGVVUklDb21wb25lbnQiLCJzbGljZSIsInYiLCJnZXRBbm9ueW1vdXNVc2FnZUZyb21Db29raWUiLCJtYXAiLCJyYXciLCJ0aW1lc3RhbXBzIiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwiaXNBbm9ueW1vdXNMaW1pdGVkRnJvbUNvb2tpZSIsInJlYyIsIm5vdyIsIkRhdGUiLCJpbldpbmRvdyIsImZpbHRlciIsInQiLCJsZW5ndGgiLCJtYWtlU2V0Q29va2llSGVhZGVyRm9yQW5vbkluY3JlbWVudCIsInVuZGVmaW5lZCIsInB1c2giLCJ2YWx1ZSIsImVuY29kZVVSSUNvbXBvbmVudCIsInN0cmluZ2lmeSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/usage-node.ts\n");

/***/ }),

/***/ "(api)/./pages/api/check.ts":
/*!****************************!*\
  !*** ./pages/api/check.ts ***!
  \****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ALLOWED_MIME: () => (/* binding */ ALLOWED_MIME),\n/* harmony export */   MAX_SIZE_BYTES: () => (/* binding */ MAX_SIZE_BYTES),\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_classifier__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/classifier */ \"(api)/./lib/classifier.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"zod\");\n/* harmony import */ var _lib_usage_node__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/usage-node */ \"(api)/./lib/usage-node.ts\");\n/* harmony import */ var _lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/usage-enhanced */ \"(api)/./lib/usage-enhanced.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([zod__WEBPACK_IMPORTED_MODULE_1__]);\nzod__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nconst MAX_SIZE_BYTES = 8 * 1024 * 1024; // 8MB\nconst ALLOWED_MIME = new Set([\n    \"image/jpeg\",\n    \"image/png\",\n    \"image/heic\",\n    \"image/heif\",\n    \"image/webp\"\n]);\nconst MetaSchema = zod__WEBPACK_IMPORTED_MODULE_1__.z.record(zod__WEBPACK_IMPORTED_MODULE_1__.z.string(), zod__WEBPACK_IMPORTED_MODULE_1__.z.string()).optional();\nconst config = {\n    api: {\n        bodyParser: false,\n        externalResolver: false\n    }\n};\nfunction parseMultipart(req) {\n    return new Promise((resolve, reject)=>{\n        const busboy = __webpack_require__(/*! busboy */ \"busboy\");\n        const bb = busboy({\n            headers: req.headers\n        });\n        let fileBuffer;\n        let mime = \"\";\n        let filename = \"\";\n        const meta = {};\n        bb.on(\"file\", (_name, file, info)=>{\n            mime = info.mimeType || info.mimetype || \"\";\n            filename = info.filename || \"upload\";\n            const chunks = [];\n            file.on(\"data\", (d)=>{\n                chunks.push(d);\n                if (Buffer.concat(chunks).length > MAX_SIZE_BYTES) {\n                    bb.emit(\"error\", new Error(\"FILE_TOO_LARGE\"));\n                    file.resume();\n                }\n            });\n            file.on(\"end\", ()=>{\n                fileBuffer = Buffer.concat(chunks);\n            });\n        });\n        bb.on(\"field\", (name, val)=>{\n            meta[name] = val;\n        });\n        bb.on(\"error\", reject);\n        bb.on(\"close\", ()=>resolve({\n                file: fileBuffer ? {\n                    buffer: fileBuffer,\n                    mimetype: mime,\n                    filename\n                } : undefined,\n                meta\n            }));\n        req.pipe(bb);\n    });\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") return res.status(405).json({\n        error: \"Method not allowed\"\n    });\n    // Get client fingerprint for abuse prevention\n    const { ipHash, uaHash } = (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__.getClientFingerprint)(req);\n    // Get user ID from headers (if available)\n    const userId = req.headers[\"x-user-id\"];\n    // Check rate limiting (10 requests per hour per IP)\n    const rateLimitOk = await (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__.checkRateLimit)(ipHash, \"check\");\n    if (!rateLimitOk) {\n        return res.status(429).json({\n            error: \"Rate limit exceeded. Please try again later.\"\n        });\n    }\n    // Check for abuse patterns\n    const isAbuse = await (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__.detectAbuse)(ipHash, uaHash);\n    if (isAbuse) {\n        return res.status(429).json({\n            error: \"Suspicious activity detected. Please contact support.\"\n        });\n    }\n    try {\n        const { file, meta } = await parseMultipart(req);\n        const userIdFromForm = meta?.userId;\n        // Use userId from form if available, otherwise from headers\n        const finalUserId = userIdFromForm || userId;\n        // Get usage stats with the correct userId\n        const usageStats = await (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__.getUsageStats)(finalUserId, ipHash, uaHash);\n        // Check if user is limited (legacy cookie check for backward compatibility)\n        // Disabled cookie check since we're using database tracking\n        const cookieLimited = false;\n        // Check if user has exceeded freemium limits\n        console.log(\"\\uD83D\\uDD0D Paywall check:\", {\n            isFreemiumDisabled: (0,_lib_usage_node__WEBPACK_IMPORTED_MODULE_2__.isFreemiumDisabled)(),\n            usageStats,\n            cookieLimited,\n            finalUserId,\n            shouldTriggerPaywall: !(0,_lib_usage_node__WEBPACK_IMPORTED_MODULE_2__.isFreemiumDisabled)() && (usageStats.isLimited || cookieLimited) && !finalUserId\n        });\n        if (!(0,_lib_usage_node__WEBPACK_IMPORTED_MODULE_2__.isFreemiumDisabled)() && (usageStats.isLimited || cookieLimited) && !finalUserId) {\n            console.log(\"\\uD83D\\uDEAB Triggering paywall for anonymous user\");\n            return res.status(402).json({\n                error: \"Paywall\",\n                usage: {\n                    freeChecksUsed: usageStats.freeChecksUsed,\n                    paidChecksRemaining: usageStats.paidChecksRemaining,\n                    checkType: \"free\"\n                }\n            });\n        }\n        // Check if authenticated user has no free checks AND no paid checks\n        if (!(0,_lib_usage_node__WEBPACK_IMPORTED_MODULE_2__.isFreemiumDisabled)() && finalUserId && usageStats.isLimited && usageStats.paidChecksRemaining === 0) {\n            return res.status(402).json({\n                error: \"Paywall\",\n                usage: {\n                    freeChecksUsed: usageStats.freeChecksUsed,\n                    paidChecksRemaining: usageStats.paidChecksRemaining,\n                    checkType: \"free\"\n                }\n            });\n        }\n        if (!file) return res.status(400).json({\n            error: \"Missing file\"\n        });\n        if (!ALLOWED_MIME.has(file.mimetype)) return res.status(400).json({\n            error: \"Invalid file type\"\n        });\n        if (file.buffer.length > MAX_SIZE_BYTES) return res.status(400).json({\n            error: \"File too large\"\n        });\n        const safeMeta = MetaSchema.parse(meta) || {};\n        const dataUrl = `data:${file.mimetype};base64,${file.buffer.toString(\"base64\")}`;\n        // Pass the data URL to the classifier so OpenAI can read it; include original filename in metadata\n        const result = await (0,_lib_classifier__WEBPACK_IMPORTED_MODULE_0__.callImageClassifier)(dataUrl, {\n            ...safeMeta,\n            filename: file.filename || \"upload\"\n        });\n        // Determine check type and log usage\n        let checkType = \"free\";\n        if (finalUserId && usageStats.paidChecksRemaining > 0) {\n            // User has paid checks, use one of those\n            const deducted = await (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__.deductPaidCheck)(finalUserId);\n            if (deducted) {\n                checkType = \"paid\";\n            }\n        }\n        // Always log the usage (free or paid)\n        await (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__.logUsage)(finalUserId || null, ipHash, uaHash, checkType);\n        // Get updated usage stats after logging\n        const updatedUsageStats = await (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_3__.getUsageStats)(finalUserId, ipHash, uaHash);\n        // Set cookie for anonymous users (legacy support)\n        if (!finalUserId) {\n            const setCookie = (0,_lib_usage_node__WEBPACK_IMPORTED_MODULE_2__.makeSetCookieHeaderForAnonIncrement)(req.headers.cookie);\n            if (setCookie) res.setHeader(\"Set-Cookie\", setCookie);\n        }\n        // Add usage info to response\n        // If freemium limits are disabled, show a more reasonable usage count\n        let displayUsage = {\n            freeChecksUsed: updatedUsageStats.freeChecksUsed,\n            paidChecksRemaining: updatedUsageStats.paidChecksRemaining,\n            checkType\n        };\n        // Override usage display when freemium limits are disabled\n        if ((0,_lib_usage_node__WEBPACK_IMPORTED_MODULE_2__.isFreemiumDisabled)()) {\n            // Show actual usage but don't enforce limits\n            displayUsage = {\n                freeChecksUsed: updatedUsageStats.freeChecksUsed,\n                paidChecksRemaining: updatedUsageStats.paidChecksRemaining,\n                checkType\n            };\n        }\n        const response = {\n            ...result,\n            usage: displayUsage\n        };\n        return res.status(200).json(response);\n    } catch (e) {\n        const msg = e?.message || \"Server error\";\n        if (msg === \"FILE_TOO_LARGE\") return res.status(400).json({\n            error: \"File too large\"\n        });\n        return res.status(500).json({\n            error: msg\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUN5RCxNQUFNO1lBQ3hFLElBQUlELFdBQVc5QixJQUFJZ0MsU0FBUyxDQUFDLGNBQWNGO1FBQzVDO1FBRUEsNkJBQTZCO1FBQzdCLHNFQUFzRTtRQUN0RSxJQUFJRyxlQUFlO1lBQ2xCZCxnQkFBZ0JVLGtCQUFrQlYsY0FBYztZQUNoREMscUJBQXFCUyxrQkFBa0JULG1CQUFtQjtZQUMxREM7UUFDRDtRQUVBLDJEQUEyRDtRQUMzRCxJQUFJekUsbUVBQWtCQSxJQUFJO1lBQ3pCLDZDQUE2QztZQUM3Q3FGLGVBQWU7Z0JBQ2RkLGdCQUFnQlUsa0JBQWtCVixjQUFjO2dCQUNoREMscUJBQXFCUyxrQkFBa0JULG1CQUFtQjtnQkFDMURDO1lBQ0Q7UUFDRDtRQUVBLE1BQU1hLFdBQVc7WUFDaEIsR0FBR1AsTUFBTTtZQUNUVCxPQUFPZTtRQUNSO1FBRUEsT0FBT2pDLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUMrQjtJQUM3QixFQUFFLE9BQU9DLEdBQVE7UUFDaEIsTUFBTUMsTUFBTUQsR0FBR0UsV0FBVztRQUMxQixJQUFJRCxRQUFRLGtCQUFrQixPQUFPcEMsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWlCO1FBQ3BGLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBT2dDO1FBQUk7SUFDMUM7QUFDRCIsInNvdXJjZXMiOlsid2VicGFjazovL2xhYnVidXMtY2hlY2tlci8uL3BhZ2VzL2FwaS9jaGVjay50cz8wOGU3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XG5pbXBvcnQgeyBjYWxsSW1hZ2VDbGFzc2lmaWVyIH0gZnJvbSBcIkAvbGliL2NsYXNzaWZpZXJcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBpc0Fub255bW91c0xpbWl0ZWRGcm9tQ29va2llLCBtYWtlU2V0Q29va2llSGVhZGVyRm9yQW5vbkluY3JlbWVudCwgaXNGcmVlbWl1bURpc2FibGVkIH0gZnJvbSBcIkAvbGliL3VzYWdlLW5vZGVcIjtcbmltcG9ydCB7IFxuICBnZXRDbGllbnRGaW5nZXJwcmludCwgXG4gIGdldFVzYWdlU3RhdHMsIFxuICBsb2dVc2FnZSwgXG4gIGNoZWNrUmF0ZUxpbWl0LCBcbiAgZGV0ZWN0QWJ1c2UsIFxuICBkZWR1Y3RQYWlkQ2hlY2sgXG59IGZyb20gXCJAL2xpYi91c2FnZS1lbmhhbmNlZFwiO1xuXG5leHBvcnQgY29uc3QgTUFYX1NJWkVfQllURVMgPSA4ICogMTAyNCAqIDEwMjQ7IC8vIDhNQlxuZXhwb3J0IGNvbnN0IEFMTE9XRURfTUlNRSA9IG5ldyBTZXQoW1wiaW1hZ2UvanBlZ1wiLCBcImltYWdlL3BuZ1wiLCBcImltYWdlL2hlaWNcIiwgXCJpbWFnZS9oZWlmXCIsIFwiaW1hZ2Uvd2VicFwiXSk7XG5cbmNvbnN0IE1ldGFTY2hlbWEgPSB6LnJlY29yZCh6LnN0cmluZygpLCB6LnN0cmluZygpKS5vcHRpb25hbCgpO1xuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuXHRhcGk6IHtcblx0XHRib2R5UGFyc2VyOiBmYWxzZSxcblx0XHRleHRlcm5hbFJlc29sdmVyOiBmYWxzZSxcblx0fSxcbn07XG5cbmZ1bmN0aW9uIHBhcnNlTXVsdGlwYXJ0KHJlcTogTmV4dEFwaVJlcXVlc3QpOiBQcm9taXNlPHsgZmlsZT86IHsgYnVmZmVyOiBCdWZmZXI7IG1pbWV0eXBlOiBzdHJpbmc7IGZpbGVuYW1lOiBzdHJpbmcgfTsgbWV0YT86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfT4ge1xuXHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdGNvbnN0IGJ1c2JveSA9IHJlcXVpcmUoXCJidXNib3lcIik7XG5cdFx0Y29uc3QgYmIgPSBidXNib3koeyBoZWFkZXJzOiByZXEuaGVhZGVycyB9KTtcblx0XHRsZXQgZmlsZUJ1ZmZlcjogQnVmZmVyIHwgdW5kZWZpbmVkO1xuXHRcdGxldCBtaW1lID0gXCJcIjtcblx0XHRsZXQgZmlsZW5hbWUgPSBcIlwiO1xuXHRcdGNvbnN0IG1ldGE6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcblxuXHRcdGJiLm9uKFwiZmlsZVwiLCAoX25hbWU6IHN0cmluZywgZmlsZTogYW55LCBpbmZvOiBhbnkpID0+IHtcblx0XHRcdG1pbWUgPSBpbmZvLm1pbWVUeXBlIHx8IGluZm8ubWltZXR5cGUgfHwgXCJcIjtcblx0XHRcdGZpbGVuYW1lID0gaW5mby5maWxlbmFtZSB8fCBcInVwbG9hZFwiO1xuXHRcdFx0Y29uc3QgY2h1bmtzOiBCdWZmZXJbXSA9IFtdO1xuXHRcdFx0ZmlsZS5vbihcImRhdGFcIiwgKGQ6IEJ1ZmZlcikgPT4ge1xuXHRcdFx0XHRjaHVua3MucHVzaChkKTtcblx0XHRcdFx0aWYgKEJ1ZmZlci5jb25jYXQoY2h1bmtzKS5sZW5ndGggPiBNQVhfU0laRV9CWVRFUykge1xuXHRcdFx0XHRcdGJiLmVtaXQoXCJlcnJvclwiLCBuZXcgRXJyb3IoXCJGSUxFX1RPT19MQVJHRVwiKSk7XG5cdFx0XHRcdFx0ZmlsZS5yZXN1bWUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRmaWxlLm9uKFwiZW5kXCIsICgpID0+IHsgZmlsZUJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoY2h1bmtzKTsgfSk7XG5cdFx0fSk7XG5cblx0XHRiYi5vbihcImZpZWxkXCIsIChuYW1lOiBzdHJpbmcsIHZhbDogc3RyaW5nKSA9PiB7IG1ldGFbbmFtZV0gPSB2YWw7IH0pO1xuXHRcdGJiLm9uKFwiZXJyb3JcIiwgcmVqZWN0KTtcblx0XHRiYi5vbihcImNsb3NlXCIsICgpID0+IHJlc29sdmUoeyBmaWxlOiBmaWxlQnVmZmVyID8geyBidWZmZXI6IGZpbGVCdWZmZXIsIG1pbWV0eXBlOiBtaW1lLCBmaWxlbmFtZSB9IDogdW5kZWZpbmVkLCBtZXRhIH0pKTtcblx0XHRyZXEucGlwZShiYik7XG5cdH0pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XG5cdGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6IFwiTWV0aG9kIG5vdCBhbGxvd2VkXCIgfSk7XG5cblx0Ly8gR2V0IGNsaWVudCBmaW5nZXJwcmludCBmb3IgYWJ1c2UgcHJldmVudGlvblxuXHRjb25zdCB7IGlwSGFzaCwgdWFIYXNoIH0gPSBnZXRDbGllbnRGaW5nZXJwcmludChyZXEpO1xuXHRcblx0Ly8gR2V0IHVzZXIgSUQgZnJvbSBoZWFkZXJzIChpZiBhdmFpbGFibGUpXG5cdGNvbnN0IHVzZXJJZCA9IHJlcS5oZWFkZXJzWyd4LXVzZXItaWQnXSBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cdFxuXHQvLyBDaGVjayByYXRlIGxpbWl0aW5nICgxMCByZXF1ZXN0cyBwZXIgaG91ciBwZXIgSVApXG5cdGNvbnN0IHJhdGVMaW1pdE9rID0gYXdhaXQgY2hlY2tSYXRlTGltaXQoaXBIYXNoLCAnY2hlY2snKTtcblx0aWYgKCFyYXRlTGltaXRPaykge1xuXHRcdHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IGVycm9yOiBcIlJhdGUgbGltaXQgZXhjZWVkZWQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIgfSk7XG5cdH1cblx0XG5cdC8vIENoZWNrIGZvciBhYnVzZSBwYXR0ZXJuc1xuXHRjb25zdCBpc0FidXNlID0gYXdhaXQgZGV0ZWN0QWJ1c2UoaXBIYXNoLCB1YUhhc2gpO1xuXHRpZiAoaXNBYnVzZSkge1xuXHRcdHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IGVycm9yOiBcIlN1c3BpY2lvdXMgYWN0aXZpdHkgZGV0ZWN0ZWQuIFBsZWFzZSBjb250YWN0IHN1cHBvcnQuXCIgfSk7XG5cdH1cblxuXHR0cnkge1xuXHRcdGNvbnN0IHsgZmlsZSwgbWV0YSB9ID0gYXdhaXQgcGFyc2VNdWx0aXBhcnQocmVxKTtcblx0XHRjb25zdCB1c2VySWRGcm9tRm9ybSA9IG1ldGE/LnVzZXJJZDtcblx0XHRcblx0XHQvLyBVc2UgdXNlcklkIGZyb20gZm9ybSBpZiBhdmFpbGFibGUsIG90aGVyd2lzZSBmcm9tIGhlYWRlcnNcblx0XHRjb25zdCBmaW5hbFVzZXJJZCA9IHVzZXJJZEZyb21Gb3JtIHx8IHVzZXJJZDtcblx0XHRcblx0XHQvLyBHZXQgdXNhZ2Ugc3RhdHMgd2l0aCB0aGUgY29ycmVjdCB1c2VySWRcblx0XHRjb25zdCB1c2FnZVN0YXRzID0gYXdhaXQgZ2V0VXNhZ2VTdGF0cyhmaW5hbFVzZXJJZCwgaXBIYXNoLCB1YUhhc2gpO1xuXHRcdFxuXHRcdC8vIENoZWNrIGlmIHVzZXIgaXMgbGltaXRlZCAobGVnYWN5IGNvb2tpZSBjaGVjayBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSlcblx0XHQvLyBEaXNhYmxlZCBjb29raWUgY2hlY2sgc2luY2Ugd2UncmUgdXNpbmcgZGF0YWJhc2UgdHJhY2tpbmdcblx0XHRjb25zdCBjb29raWVMaW1pdGVkID0gZmFsc2U7XG5cdFx0XG5cdFx0Ly8gQ2hlY2sgaWYgdXNlciBoYXMgZXhjZWVkZWQgZnJlZW1pdW0gbGltaXRzXG5cdFx0Y29uc29sZS5sb2coJ/CflI0gUGF5d2FsbCBjaGVjazonLCB7IFxuXHRcdFx0aXNGcmVlbWl1bURpc2FibGVkOiBpc0ZyZWVtaXVtRGlzYWJsZWQoKSwgXG5cdFx0XHR1c2FnZVN0YXRzLCBcblx0XHRcdGNvb2tpZUxpbWl0ZWQsIFxuXHRcdFx0ZmluYWxVc2VySWQsXG5cdFx0XHRzaG91bGRUcmlnZ2VyUGF5d2FsbDogIWlzRnJlZW1pdW1EaXNhYmxlZCgpICYmICh1c2FnZVN0YXRzLmlzTGltaXRlZCB8fCBjb29raWVMaW1pdGVkKSAmJiAhZmluYWxVc2VySWRcblx0XHR9KTtcblx0XHRcblx0XHRpZiAoIWlzRnJlZW1pdW1EaXNhYmxlZCgpICYmICh1c2FnZVN0YXRzLmlzTGltaXRlZCB8fCBjb29raWVMaW1pdGVkKSAmJiAhZmluYWxVc2VySWQpIHtcblx0XHRcdGNvbnNvbGUubG9nKCfwn5qrIFRyaWdnZXJpbmcgcGF5d2FsbCBmb3IgYW5vbnltb3VzIHVzZXInKTtcblx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMikuanNvbih7IFxuXHRcdFx0XHRlcnJvcjogXCJQYXl3YWxsXCIsXG5cdFx0XHRcdHVzYWdlOiB7XG5cdFx0XHRcdFx0ZnJlZUNoZWNrc1VzZWQ6IHVzYWdlU3RhdHMuZnJlZUNoZWNrc1VzZWQsXG5cdFx0XHRcdFx0cGFpZENoZWNrc1JlbWFpbmluZzogdXNhZ2VTdGF0cy5wYWlkQ2hlY2tzUmVtYWluaW5nLFxuXHRcdFx0XHRcdGNoZWNrVHlwZTogJ2ZyZWUnXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0XHRcblx0XHQvLyBDaGVjayBpZiBhdXRoZW50aWNhdGVkIHVzZXIgaGFzIG5vIGZyZWUgY2hlY2tzIEFORCBubyBwYWlkIGNoZWNrc1xuXHRcdGlmICghaXNGcmVlbWl1bURpc2FibGVkKCkgJiYgZmluYWxVc2VySWQgJiYgdXNhZ2VTdGF0cy5pc0xpbWl0ZWQgJiYgdXNhZ2VTdGF0cy5wYWlkQ2hlY2tzUmVtYWluaW5nID09PSAwKSB7XG5cdFx0XHRyZXR1cm4gcmVzLnN0YXR1cyg0MDIpLmpzb24oeyBcblx0XHRcdFx0ZXJyb3I6IFwiUGF5d2FsbFwiLFxuXHRcdFx0XHR1c2FnZToge1xuXHRcdFx0XHRcdGZyZWVDaGVja3NVc2VkOiB1c2FnZVN0YXRzLmZyZWVDaGVja3NVc2VkLFxuXHRcdFx0XHRcdHBhaWRDaGVja3NSZW1haW5pbmc6IHVzYWdlU3RhdHMucGFpZENoZWNrc1JlbWFpbmluZyxcblx0XHRcdFx0XHRjaGVja1R5cGU6ICdmcmVlJ1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0aWYgKCFmaWxlKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJNaXNzaW5nIGZpbGVcIiB9KTtcblx0XHRpZiAoIUFMTE9XRURfTUlNRS5oYXMoZmlsZS5taW1ldHlwZSkpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIkludmFsaWQgZmlsZSB0eXBlXCIgfSk7XG5cdFx0aWYgKGZpbGUuYnVmZmVyLmxlbmd0aCA+IE1BWF9TSVpFX0JZVEVTKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJGaWxlIHRvbyBsYXJnZVwiIH0pO1xuXG5cdFx0Y29uc3Qgc2FmZU1ldGEgPSBNZXRhU2NoZW1hLnBhcnNlKG1ldGEpIHx8IHt9O1xuXHRcdGNvbnN0IGRhdGFVcmwgPSBgZGF0YToke2ZpbGUubWltZXR5cGV9O2Jhc2U2NCwke2ZpbGUuYnVmZmVyLnRvU3RyaW5nKFwiYmFzZTY0XCIpfWA7XG5cblx0XHQvLyBQYXNzIHRoZSBkYXRhIFVSTCB0byB0aGUgY2xhc3NpZmllciBzbyBPcGVuQUkgY2FuIHJlYWQgaXQ7IGluY2x1ZGUgb3JpZ2luYWwgZmlsZW5hbWUgaW4gbWV0YWRhdGFcblx0XHRjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsSW1hZ2VDbGFzc2lmaWVyKGRhdGFVcmwsIHsgLi4uc2FmZU1ldGEsIGZpbGVuYW1lOiBmaWxlLmZpbGVuYW1lIHx8IFwidXBsb2FkXCIgfSk7XG5cblx0XHQvLyBEZXRlcm1pbmUgY2hlY2sgdHlwZSBhbmQgbG9nIHVzYWdlXG5cdFx0bGV0IGNoZWNrVHlwZTogJ2ZyZWUnIHwgJ3BhaWQnID0gJ2ZyZWUnO1xuXHRcdFxuXHRcdGlmIChmaW5hbFVzZXJJZCAmJiB1c2FnZVN0YXRzLnBhaWRDaGVja3NSZW1haW5pbmcgPiAwKSB7XG5cdFx0XHQvLyBVc2VyIGhhcyBwYWlkIGNoZWNrcywgdXNlIG9uZSBvZiB0aG9zZVxuXHRcdFx0Y29uc3QgZGVkdWN0ZWQgPSBhd2FpdCBkZWR1Y3RQYWlkQ2hlY2soZmluYWxVc2VySWQpO1xuXHRcdFx0aWYgKGRlZHVjdGVkKSB7XG5cdFx0XHRcdGNoZWNrVHlwZSA9ICdwYWlkJztcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0Ly8gQWx3YXlzIGxvZyB0aGUgdXNhZ2UgKGZyZWUgb3IgcGFpZClcblx0XHRhd2FpdCBsb2dVc2FnZShmaW5hbFVzZXJJZCB8fCBudWxsLCBpcEhhc2gsIHVhSGFzaCwgY2hlY2tUeXBlKTtcblxuXHRcdC8vIEdldCB1cGRhdGVkIHVzYWdlIHN0YXRzIGFmdGVyIGxvZ2dpbmdcblx0XHRjb25zdCB1cGRhdGVkVXNhZ2VTdGF0cyA9IGF3YWl0IGdldFVzYWdlU3RhdHMoZmluYWxVc2VySWQsIGlwSGFzaCwgdWFIYXNoKTtcblxuXHRcdC8vIFNldCBjb29raWUgZm9yIGFub255bW91cyB1c2VycyAobGVnYWN5IHN1cHBvcnQpXG5cdFx0aWYgKCFmaW5hbFVzZXJJZCkge1xuXHRcdFx0Y29uc3Qgc2V0Q29va2llID0gbWFrZVNldENvb2tpZUhlYWRlckZvckFub25JbmNyZW1lbnQocmVxLmhlYWRlcnMuY29va2llKTtcblx0XHRcdGlmIChzZXRDb29raWUpIHJlcy5zZXRIZWFkZXIoJ1NldC1Db29raWUnLCBzZXRDb29raWUpO1xuXHRcdH1cblx0XHRcblx0XHQvLyBBZGQgdXNhZ2UgaW5mbyB0byByZXNwb25zZVxuXHRcdC8vIElmIGZyZWVtaXVtIGxpbWl0cyBhcmUgZGlzYWJsZWQsIHNob3cgYSBtb3JlIHJlYXNvbmFibGUgdXNhZ2UgY291bnRcblx0XHRsZXQgZGlzcGxheVVzYWdlID0ge1xuXHRcdFx0ZnJlZUNoZWNrc1VzZWQ6IHVwZGF0ZWRVc2FnZVN0YXRzLmZyZWVDaGVja3NVc2VkLFxuXHRcdFx0cGFpZENoZWNrc1JlbWFpbmluZzogdXBkYXRlZFVzYWdlU3RhdHMucGFpZENoZWNrc1JlbWFpbmluZyxcblx0XHRcdGNoZWNrVHlwZVxuXHRcdH07XG5cdFx0XG5cdFx0Ly8gT3ZlcnJpZGUgdXNhZ2UgZGlzcGxheSB3aGVuIGZyZWVtaXVtIGxpbWl0cyBhcmUgZGlzYWJsZWRcblx0XHRpZiAoaXNGcmVlbWl1bURpc2FibGVkKCkpIHtcblx0XHRcdC8vIFNob3cgYWN0dWFsIHVzYWdlIGJ1dCBkb24ndCBlbmZvcmNlIGxpbWl0c1xuXHRcdFx0ZGlzcGxheVVzYWdlID0ge1xuXHRcdFx0XHRmcmVlQ2hlY2tzVXNlZDogdXBkYXRlZFVzYWdlU3RhdHMuZnJlZUNoZWNrc1VzZWQsXG5cdFx0XHRcdHBhaWRDaGVja3NSZW1haW5pbmc6IHVwZGF0ZWRVc2FnZVN0YXRzLnBhaWRDaGVja3NSZW1haW5pbmcsXG5cdFx0XHRcdGNoZWNrVHlwZVxuXHRcdFx0fTtcblx0XHR9XG5cdFx0XG5cdFx0Y29uc3QgcmVzcG9uc2UgPSB7XG5cdFx0XHQuLi5yZXN1bHQsXG5cdFx0XHR1c2FnZTogZGlzcGxheVVzYWdlXG5cdFx0fTtcblx0XHRcblx0XHRyZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24ocmVzcG9uc2UpO1xuXHR9IGNhdGNoIChlOiBhbnkpIHtcblx0XHRjb25zdCBtc2cgPSBlPy5tZXNzYWdlIHx8IFwiU2VydmVyIGVycm9yXCI7XG5cdFx0aWYgKG1zZyA9PT0gXCJGSUxFX1RPT19MQVJHRVwiKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJGaWxlIHRvbyBsYXJnZVwiIH0pO1xuXHRcdHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBtc2cgfSk7XG5cdH1cbn1cbiJdLCJuYW1lcyI6WyJjYWxsSW1hZ2VDbGFzc2lmaWVyIiwieiIsIm1ha2VTZXRDb29raWVIZWFkZXJGb3JBbm9uSW5jcmVtZW50IiwiaXNGcmVlbWl1bURpc2FibGVkIiwiZ2V0Q2xpZW50RmluZ2VycHJpbnQiLCJnZXRVc2FnZVN0YXRzIiwibG9nVXNhZ2UiLCJjaGVja1JhdGVMaW1pdCIsImRldGVjdEFidXNlIiwiZGVkdWN0UGFpZENoZWNrIiwiTUFYX1NJWkVfQllURVMiLCJBTExPV0VEX01JTUUiLCJTZXQiLCJNZXRhU2NoZW1hIiwicmVjb3JkIiwic3RyaW5nIiwib3B0aW9uYWwiLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwiZXh0ZXJuYWxSZXNvbHZlciIsInBhcnNlTXVsdGlwYXJ0IiwicmVxIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJidXNib3kiLCJyZXF1aXJlIiwiYmIiLCJoZWFkZXJzIiwiZmlsZUJ1ZmZlciIsIm1pbWUiLCJmaWxlbmFtZSIsIm1ldGEiLCJvbiIsIl9uYW1lIiwiZmlsZSIsImluZm8iLCJtaW1lVHlwZSIsIm1pbWV0eXBlIiwiY2h1bmtzIiwiZCIsInB1c2giLCJCdWZmZXIiLCJjb25jYXQiLCJsZW5ndGgiLCJlbWl0IiwiRXJyb3IiLCJyZXN1bWUiLCJuYW1lIiwidmFsIiwiYnVmZmVyIiwidW5kZWZpbmVkIiwicGlwZSIsImhhbmRsZXIiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJpcEhhc2giLCJ1YUhhc2giLCJ1c2VySWQiLCJyYXRlTGltaXRPayIsImlzQWJ1c2UiLCJ1c2VySWRGcm9tRm9ybSIsImZpbmFsVXNlcklkIiwidXNhZ2VTdGF0cyIsImNvb2tpZUxpbWl0ZWQiLCJjb25zb2xlIiwibG9nIiwic2hvdWxkVHJpZ2dlclBheXdhbGwiLCJpc0xpbWl0ZWQiLCJ1c2FnZSIsImZyZWVDaGVja3NVc2VkIiwicGFpZENoZWNrc1JlbWFpbmluZyIsImNoZWNrVHlwZSIsImhhcyIsInNhZmVNZXRhIiwicGFyc2UiLCJkYXRhVXJsIiwidG9TdHJpbmciLCJyZXN1bHQiLCJkZWR1Y3RlZCIsInVwZGF0ZWRVc2FnZVN0YXRzIiwic2V0Q29va2llIiwiY29va2llIiwic2V0SGVhZGVyIiwiZGlzcGxheVVzYWdlIiwicmVzcG9uc2UiLCJlIiwibXNnIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/check.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcheck&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccheck.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();