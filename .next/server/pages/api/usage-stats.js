"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/usage-stats";
exports.ids = ["pages/api/usage-stats"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusage-stats&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cusage-stats.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusage-stats&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cusage-stats.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_usage_stats_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\usage-stats.ts */ \"(api)/./pages/api/usage-stats.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_usage_stats_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_usage_stats_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/usage-stats\",\n        pathname: \"/api/usage-stats\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_usage_stats_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnVzYWdlLXN0YXRzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUN1c2FnZS1zdGF0cy50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUN5RDtBQUN6RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsc0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHNEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL2xhYnVidXMtY2hlY2tlci8/MmI2MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHVzYWdlLXN0YXRzLnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvdXNhZ2Utc3RhdHNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS91c2FnZS1zdGF0c1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusage-stats&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cusage-stats.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/db.ts":
/*!*******************!*\
  !*** ./lib/db.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createClient: () => (/* binding */ createClient),\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://cfyohvsacffjgzpjrywn.supabase.co\" || 0, \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmeW9odnNhY2Zmamd6cGpyeXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjEzNDMsImV4cCI6MjA3MDQzNzM0M30.RdZJp0Z041_fEyFN10c_dkAJ-nVaSmttovBhj36VrnA\" || 0);\n// Export createClient for the enhanced usage system\nconst createClient = ()=>(0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://cfyohvsacffjgzpjrywn.supabase.co\" || 0, process.env.SUPABASE_SERVICE_ROLE_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmeW9odnNhY2Zmamd6cGpyeXduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4NjEzNDMsImV4cCI6MjA3MDQzNzM0M30.RdZJp0Z041_fEyFN10c_dkAJ-nVaSmttovBhj36VrnA\" || 0);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZGIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUE2RTtBQUV0RSxNQUFNRSxXQUFXRCxtRUFBb0JBLENBQzNDRSwwQ0FBb0MsSUFBSSxDQUFFLEVBQzFDQSxrTkFBeUMsSUFBSSxDQUFFLEVBQzlDO0FBRUYsb0RBQW9EO0FBQzdDLE1BQU1ILGVBQWUsSUFBTUMsbUVBQW9CQSxDQUNyREUsMENBQW9DLElBQUksQ0FBRSxFQUMxQ0EsUUFBUUMsR0FBRyxDQUFDRyx5QkFBeUIsSUFBSUosa05BQXlDLElBQUksQ0FBRSxFQUN2RiIsInNvdXJjZXMiOlsid2VicGFjazovL2xhYnVidXMtY2hlY2tlci8uL2xpYi9kYi50cz8xZGYwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCBhcyBjcmVhdGVTdXBhYmFzZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU3VwYWJhc2VDbGllbnQoXG5cdHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCBcIlwiLFxuXHRwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCBcIlwiXG4pO1xuXG4vLyBFeHBvcnQgY3JlYXRlQ2xpZW50IGZvciB0aGUgZW5oYW5jZWQgdXNhZ2Ugc3lzdGVtXG5leHBvcnQgY29uc3QgY3JlYXRlQ2xpZW50ID0gKCkgPT4gY3JlYXRlU3VwYWJhc2VDbGllbnQoXG5cdHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCBcIlwiLFxuXHRwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8IFwiXCJcbik7XG5cbmV4cG9ydCB0eXBlIEhpc3RvcnlJdGVtID0ge1xuXHRpZDogc3RyaW5nO1xuXHR1c2VyX2lkPzogc3RyaW5nIHwgbnVsbDtcblx0aW1hZ2VfdXJsOiBzdHJpbmc7XG5cdGxhYmVsOiBcIkxpa2VseSBBdXRoZW50aWNcIiB8IFwiU3VzcGljaW91c1wiIHwgXCJGYWtlXCI7XG5cdHJlYXNvbjogc3RyaW5nO1xuXHRjb25maWRlbmNlOiBudW1iZXI7XG5cdGNyZWF0ZWRfYXQ6IHN0cmluZztcbn07XG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwiY3JlYXRlU3VwYWJhc2VDbGllbnQiLCJzdXBhYmFzZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/db.ts\n");

/***/ }),

/***/ "(api)/./lib/usage-enhanced.ts":
/*!*******************************!*\
  !*** ./lib/usage-enhanced.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addPaidChecks: () => (/* binding */ addPaidChecks),\n/* harmony export */   checkRateLimit: () => (/* binding */ checkRateLimit),\n/* harmony export */   deductPaidCheck: () => (/* binding */ deductPaidCheck),\n/* harmony export */   detectAbuse: () => (/* binding */ detectAbuse),\n/* harmony export */   getClientFingerprint: () => (/* binding */ getClientFingerprint),\n/* harmony export */   getUsageStats: () => (/* binding */ getUsageStats),\n/* harmony export */   hashIP: () => (/* binding */ hashIP),\n/* harmony export */   hashUserAgent: () => (/* binding */ hashUserAgent),\n/* harmony export */   logUsage: () => (/* binding */ logUsage)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\n// Mock database for testing\nconst mockSupabase = {\n    from: (table)=>({\n            select: (columns = \"*\")=>({\n                    eq: (column, value)=>({\n                            gte: (column, value)=>({\n                                    single: ()=>Promise.resolve({\n                                            data: null,\n                                            error: null\n                                        }),\n                                    then: (callback)=>Promise.resolve(callback({\n                                            data: [],\n                                            error: null\n                                        }))\n                                }),\n                            then: (callback)=>Promise.resolve(callback({\n                                    data: [],\n                                    error: null\n                                }))\n                        }),\n                    gte: (column, value)=>({\n                            then: (callback)=>Promise.resolve(callback({\n                                    data: [],\n                                    error: null\n                                }))\n                        }),\n                    then: (callback)=>Promise.resolve(callback({\n                            data: [],\n                            error: null\n                        }))\n                }),\n            insert: (data)=>Promise.resolve({\n                    data: null,\n                    error: null\n                }),\n            update: (data)=>({\n                    eq: (column, value)=>({\n                            eq: (column, value)=>({\n                                    select: (columns)=>({\n                                            single: ()=>Promise.resolve({\n                                                    data: {\n                                                        remaining_checks: 5\n                                                    },\n                                                    error: null\n                                                })\n                                        })\n                                }),\n                            select: (columns)=>({\n                                    single: ()=>Promise.resolve({\n                                            data: {\n                                                remaining_checks: 5\n                                            },\n                                            error: null\n                                        })\n                                })\n                        }),\n                    select: (columns)=>({\n                            single: ()=>Promise.resolve({\n                                    data: {\n                                        remaining_checks: 5\n                                    },\n                                    error: null\n                                })\n                        })\n                }),\n            raw: (query)=>query\n        })\n};\n// Use mock database in test environment, real database otherwise\nfunction createClient() {\n    if (false) {}\n    // Import real database client\n    const { createClient: createRealClient } = __webpack_require__(/*! ./db */ \"(api)/./lib/db.ts\");\n    const client = createRealClient();\n    console.log(\"\\uD83D\\uDD27 Usage enhanced client created\");\n    return client;\n}\n// Privacy-compliant hashing for GDPR/CCPA compliance\n// These functions create one-way hashes that cannot be reversed to original IP/UA\nfunction hashIP(ip) {\n    // Hash IP with salt for privacy - cannot be reversed to original IP\n    const salt = process.env.IP_HASH_SALT || \"default-salt-change-in-production\";\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(ip + salt).digest(\"hex\").substring(0, 16);\n}\nfunction hashUserAgent(userAgent) {\n    // Hash user agent with salt for privacy - cannot be reversed to original UA\n    const salt = process.env.UA_HASH_SALT || \"default-salt-change-in-production\";\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(userAgent + salt).digest(\"hex\").substring(0, 16);\n}\nfunction getClientFingerprint(req) {\n    // Get real IP (considering proxies)\n    const ip = req.headers[\"x-forwarded-for\"]?.split(\",\")[0] || req.headers[\"x-real-ip\"] || req.connection?.remoteAddress || req.socket?.remoteAddress || \"127.0.0.1\";\n    const userAgent = req.headers[\"user-agent\"] || \"unknown\";\n    return {\n        ipHash: hashIP(ip),\n        uaHash: hashUserAgent(userAgent)\n    };\n}\nasync function getUsageStats(userId, ipHash, uaHash) {\n    const supabase = createClient();\n    const now = new Date();\n    // Calculate the start of the current week (Monday)\n    const weekStart = new Date(now);\n    const dayOfWeek = now.getDay();\n    const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Sunday = 0, so 6 days back to Monday\n    weekStart.setDate(now.getDate() - daysToMonday);\n    weekStart.setHours(0, 0, 0, 0);\n    console.log(\"Getting usage stats for:\", {\n        userId,\n        ipHash,\n        uaHash,\n        weekStart: weekStart.toISOString()\n    });\n    console.log(\"UserId type:\", typeof userId, \"Value:\", userId);\n    // Get free checks used in the current week\n    let freeUsageQuery = supabase.from(\"usage_logs\").select(\"*\").gte(\"created_at\", weekStart.toISOString());\n    if (userId) {\n        // For authenticated users, count only free checks for this user\n        freeUsageQuery = freeUsageQuery.eq(\"user_id\", userId).eq(\"check_type\", \"free\");\n    } else {\n        // For anonymous users, count all checks (they're all free)\n        freeUsageQuery = freeUsageQuery.is(\"user_id\", null);\n    }\n    const { data: freeUsage, error: freeError } = await freeUsageQuery;\n    if (freeError) {\n        console.error(\"Error fetching free usage:\", freeError);\n    }\n    console.log(\"Free usage data:\", freeUsage);\n    const freeChecksUsed = freeUsage?.length || 0;\n    // Get paid checks remaining for user\n    let paidChecksRemaining = 0;\n    if (userId) {\n        console.log(\"\\uD83D\\uDD0D Fetching paid checks for user:\", userId);\n        const { data: user, error: userError } = await supabase.from(\"profiles\").select(\"remaining_checks\").eq(\"id\", userId).single();\n        if (userError) {\n            console.error(\"Error fetching user profile for paid checks:\", userError);\n            // If profile doesn't exist, create it\n            if (userError.code === \"PGRST116\") {\n                console.log(\"\\uD83D\\uDD27 User profile not found, creating one...\");\n                const { error: createError } = await supabase.from(\"profiles\").insert({\n                    id: userId,\n                    remaining_checks: 0\n                });\n                if (createError) {\n                    console.error(\"Error creating user profile:\", createError);\n                } else {\n                    console.log(\"\\uD83D\\uDD27 User profile created successfully\");\n                }\n            }\n        } else {\n            console.log(\"\\uD83D\\uDD0D User profile data:\", user);\n        }\n        paidChecksRemaining = user?.remaining_checks || 0;\n        console.log(\"\\uD83D\\uDD0D Paid checks remaining:\", paidChecksRemaining);\n    }\n    // Get total checks this week (for abuse detection)\n    const { data: totalUsage } = await supabase.from(\"usage_logs\").select(\"*\").gte(\"created_at\", weekStart.toISOString());\n    const totalChecksThisWeek = totalUsage?.length || 0;\n    // Check if user is limited (3 free checks per week)\n    const isLimited = freeChecksUsed >= 3;\n    console.log(\"isLimited calculation:\", {\n        freeChecksUsed,\n        isLimited\n    });\n    const result = {\n        freeChecksUsed,\n        paidChecksRemaining,\n        totalChecksThisWeek,\n        isLimited\n    };\n    console.log(\"Usage stats result:\", result);\n    return result;\n}\nasync function logUsage(userId, ipHash, uaHash, checkType) {\n    const supabase = createClient();\n    const { data, error } = await supabase.from(\"usage_logs\").insert({\n        user_id: userId || null,\n        ip_hash: ipHash,\n        user_agent_hash: uaHash,\n        check_type: checkType\n    });\n    if (error) {\n        console.error(\"Failed to log usage:\", error);\n        throw new Error(`Failed to log usage: ${error.message}`);\n    }\n    console.log(\"Successfully logged usage:\", {\n        userId,\n        ipHash,\n        uaHash,\n        checkType\n    });\n}\nasync function checkRateLimit(identifier, action = \"check\") {\n    const supabase = createClient();\n    const now = new Date();\n    const windowStart = new Date(now.getTime() - 60 * 60 * 1000); // 1 hour window\n    // Check current rate limit\n    const { data: existing } = await supabase.from(\"rate_limits\").select(\"*\").eq(\"identifier\", identifier).eq(\"action\", action).gte(\"window_start\", windowStart.toISOString()).single();\n    if (existing) {\n        // If more than 100 checks per hour, block (increased for testing)\n        if (existing.count >= 100) {\n            return false;\n        }\n        // Increment count\n        await supabase.from(\"rate_limits\").update({\n            count: existing.count + 1\n        }).eq(\"id\", existing.id);\n    } else {\n        // Create new rate limit record\n        await supabase.from(\"rate_limits\").insert({\n            identifier,\n            action,\n            count: 1,\n            window_start: now.toISOString()\n        });\n    }\n    return true;\n}\nasync function detectAbuse(ipHash, uaHash) {\n    const supabase = createClient();\n    const now = new Date();\n    // Calculate the start of the current week (Monday)\n    const weekStart = new Date(now);\n    const dayOfWeek = now.getDay();\n    const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Sunday = 0, so 6 days back to Monday\n    weekStart.setDate(now.getDate() - daysToMonday);\n    weekStart.setHours(0, 0, 0, 0);\n    // Check for suspicious activity patterns\n    const { data: ipUsage } = await supabase.from(\"usage_logs\").select(\"*\").eq(\"ip_hash\", ipHash).gte(\"created_at\", weekStart.toISOString());\n    const { data: uaUsage } = await supabase.from(\"usage_logs\").select(\"*\").eq(\"user_agent_hash\", uaHash).gte(\"created_at\", weekStart.toISOString());\n    // Flag as abuse if:\n    // - More than 50 checks from same IP this week (increased from daily limit)\n    // - More than 40 checks from same user agent this week (increased from daily limit)\n    // - More than 10 different user agents from same IP this week (increased from daily limit)\n    const ipCount = ipUsage?.length || 0;\n    const uaCount = uaUsage?.length || 0;\n    // Get unique user agents for this IP\n    const { data: uniqueUAs } = await supabase.from(\"usage_logs\").select(\"user_agent_hash\").eq(\"ip_hash\", ipHash).gte(\"created_at\", weekStart.toISOString());\n    const uniqueUACount = new Set(uniqueUAs?.map((u)=>u.user_agent_hash) || []).size;\n    return ipCount > 50 || uaCount > 40 || uniqueUACount > 10;\n}\nasync function deductPaidCheck(userId) {\n    const supabase = createClient();\n    console.log(\"\\uD83D\\uDD27 Deducting paid check for user:\", userId);\n    // First get current remaining_checks\n    const { data: currentProfile, error: fetchError } = await supabase.from(\"profiles\").select(\"remaining_checks\").eq(\"id\", userId).single();\n    if (fetchError) {\n        console.error(\"Error fetching current profile for deduction:\", fetchError);\n        return false;\n    }\n    const currentChecks = currentProfile?.remaining_checks || 0;\n    console.log(\"\\uD83D\\uDD27 Current checks before deduction:\", currentChecks);\n    if (currentChecks <= 0) {\n        console.log(\"\\uD83D\\uDD27 No checks remaining, cannot deduct\");\n        return false;\n    }\n    const newChecks = currentChecks - 1;\n    console.log(\"\\uD83D\\uDD27 Deducting check, new count will be:\", newChecks);\n    // Update with new value\n    const { data, error } = await supabase.from(\"profiles\").update({\n        remaining_checks: newChecks\n    }).eq(\"id\", userId).select(\"remaining_checks\").single();\n    if (error) {\n        console.error(\"Error deducting paid check:\", error);\n        return false;\n    }\n    console.log(\"\\uD83D\\uDD27 Successfully deducted check, new count:\", data?.remaining_checks);\n    return true;\n}\nasync function addPaidChecks(userId, checksToAdd) {\n    const supabase = createClient();\n    // First get current remaining_checks\n    const { data: currentProfile, error: fetchError } = await supabase.from(\"profiles\").select(\"remaining_checks\").eq(\"id\", userId).single();\n    if (fetchError) {\n        console.error(\"Error fetching current profile for addition:\", fetchError);\n        throw new Error(\"Failed to fetch current profile\");\n    }\n    const currentChecks = currentProfile?.remaining_checks || 0;\n    const newChecks = currentChecks + checksToAdd;\n    // Update with new value\n    const { error } = await supabase.from(\"profiles\").update({\n        remaining_checks: newChecks\n    }).eq(\"id\", userId);\n    if (error) {\n        console.error(\"Error adding paid checks:\", error);\n        throw new Error(\"Failed to add paid checks\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FDckJqRCxJQUFJLENBQUMsWUFDTGdCLE1BQU0sQ0FBQztRQUFFQyxrQkFBa0IwRjtJQUFVLEdBQ3JDdkcsRUFBRSxDQUFDLE1BQU00QztJQUVaLElBQUlwQyxPQUFPO1FBQ1RhLFFBQVFiLEtBQUssQ0FBQyw2QkFBNkJBO1FBQzNDLE1BQU0sSUFBSXNFLE1BQU07SUFDbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2xhYnVidXMtY2hlY2tlci8uL2xpYi91c2FnZS1lbmhhbmNlZC50cz8xMzEyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuLy8gTW9jayBkYXRhYmFzZSBmb3IgdGVzdGluZ1xuY29uc3QgbW9ja1N1cGFiYXNlID0ge1xuICBmcm9tOiAodGFibGU6IHN0cmluZykgPT4gKHtcbiAgICBzZWxlY3Q6IChjb2x1bW5zOiBzdHJpbmcgPSAnKicpID0+ICh7XG4gICAgICBlcTogKGNvbHVtbjogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiAoe1xuICAgICAgICBndGU6IChjb2x1bW46IHN0cmluZywgdmFsdWU6IGFueSkgPT4gKHtcbiAgICAgICAgICBzaW5nbGU6ICgpID0+IFByb21pc2UucmVzb2x2ZSh7IGRhdGE6IG51bGwsIGVycm9yOiBudWxsIH0pLFxuICAgICAgICAgIHRoZW46IChjYWxsYmFjazogYW55KSA9PiBQcm9taXNlLnJlc29sdmUoY2FsbGJhY2soeyBkYXRhOiBbXSwgZXJyb3I6IG51bGwgfSkpXG4gICAgICAgIH0pLFxuICAgICAgICB0aGVuOiAoY2FsbGJhY2s6IGFueSkgPT4gUHJvbWlzZS5yZXNvbHZlKGNhbGxiYWNrKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pKVxuICAgICAgfSksXG4gICAgICBndGU6IChjb2x1bW46IHN0cmluZywgdmFsdWU6IGFueSkgPT4gKHtcbiAgICAgICAgdGhlbjogKGNhbGxiYWNrOiBhbnkpID0+IFByb21pc2UucmVzb2x2ZShjYWxsYmFjayh7IGRhdGE6IFtdLCBlcnJvcjogbnVsbCB9KSlcbiAgICAgIH0pLFxuICAgICAgdGhlbjogKGNhbGxiYWNrOiBhbnkpID0+IFByb21pc2UucmVzb2x2ZShjYWxsYmFjayh7IGRhdGE6IFtdLCBlcnJvcjogbnVsbCB9KSlcbiAgICB9KSxcbiAgICBpbnNlcnQ6IChkYXRhOiBhbnkpID0+IFByb21pc2UucmVzb2x2ZSh7IGRhdGE6IG51bGwsIGVycm9yOiBudWxsIH0pLFxuICAgIHVwZGF0ZTogKGRhdGE6IGFueSkgPT4gKHtcbiAgICAgIGVxOiAoY29sdW1uOiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+ICh7XG4gICAgICAgIGVxOiAoY29sdW1uOiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+ICh7XG4gICAgICAgICAgc2VsZWN0OiAoY29sdW1uczogc3RyaW5nKSA9PiAoe1xuICAgICAgICAgICAgc2luZ2xlOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiB7IHJlbWFpbmluZ19jaGVja3M6IDUgfSwgZXJyb3I6IG51bGwgfSlcbiAgICAgICAgICB9KVxuICAgICAgICB9KSxcbiAgICAgICAgc2VsZWN0OiAoY29sdW1uczogc3RyaW5nKSA9PiAoe1xuICAgICAgICAgIHNpbmdsZTogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogeyByZW1haW5pbmdfY2hlY2tzOiA1IH0sIGVycm9yOiBudWxsIH0pXG4gICAgICAgIH0pXG4gICAgICB9KSxcbiAgICAgIHNlbGVjdDogKGNvbHVtbnM6IHN0cmluZykgPT4gKHtcbiAgICAgICAgc2luZ2xlOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiB7IHJlbWFpbmluZ19jaGVja3M6IDUgfSwgZXJyb3I6IG51bGwgfSlcbiAgICAgIH0pXG4gICAgfSksXG4gICAgcmF3OiAocXVlcnk6IHN0cmluZykgPT4gcXVlcnlcbiAgfSlcbn07XG5cbi8vIFVzZSBtb2NrIGRhdGFiYXNlIGluIHRlc3QgZW52aXJvbm1lbnQsIHJlYWwgZGF0YWJhc2Ugb3RoZXJ3aXNlXG5mdW5jdGlvbiBjcmVhdGVDbGllbnQoKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnKSB7XG4gICAgcmV0dXJuIG1vY2tTdXBhYmFzZTtcbiAgfVxuICBcbiAgLy8gSW1wb3J0IHJlYWwgZGF0YWJhc2UgY2xpZW50XG4gIGNvbnN0IHsgY3JlYXRlQ2xpZW50OiBjcmVhdGVSZWFsQ2xpZW50IH0gPSByZXF1aXJlKCcuL2RiJyk7XG4gIGNvbnN0IGNsaWVudCA9IGNyZWF0ZVJlYWxDbGllbnQoKTtcbiAgY29uc29sZS5sb2coJ/CflKcgVXNhZ2UgZW5oYW5jZWQgY2xpZW50IGNyZWF0ZWQnKTtcbiAgcmV0dXJuIGNsaWVudDtcbn1cblxuLy8gUHJpdmFjeS1jb21wbGlhbnQgaGFzaGluZyBmb3IgR0RQUi9DQ1BBIGNvbXBsaWFuY2Vcbi8vIFRoZXNlIGZ1bmN0aW9ucyBjcmVhdGUgb25lLXdheSBoYXNoZXMgdGhhdCBjYW5ub3QgYmUgcmV2ZXJzZWQgdG8gb3JpZ2luYWwgSVAvVUFcbmV4cG9ydCBmdW5jdGlvbiBoYXNoSVAoaXA6IHN0cmluZyk6IHN0cmluZyB7XG4gIC8vIEhhc2ggSVAgd2l0aCBzYWx0IGZvciBwcml2YWN5IC0gY2Fubm90IGJlIHJldmVyc2VkIHRvIG9yaWdpbmFsIElQXG4gIGNvbnN0IHNhbHQgPSBwcm9jZXNzLmVudi5JUF9IQVNIX1NBTFQgfHwgJ2RlZmF1bHQtc2FsdC1jaGFuZ2UtaW4tcHJvZHVjdGlvbic7XG4gIHJldHVybiBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKGlwICsgc2FsdCkuZGlnZXN0KCdoZXgnKS5zdWJzdHJpbmcoMCwgMTYpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzaFVzZXJBZ2VudCh1c2VyQWdlbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIC8vIEhhc2ggdXNlciBhZ2VudCB3aXRoIHNhbHQgZm9yIHByaXZhY3kgLSBjYW5ub3QgYmUgcmV2ZXJzZWQgdG8gb3JpZ2luYWwgVUFcbiAgY29uc3Qgc2FsdCA9IHByb2Nlc3MuZW52LlVBX0hBU0hfU0FMVCB8fCAnZGVmYXVsdC1zYWx0LWNoYW5nZS1pbi1wcm9kdWN0aW9uJztcbiAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUodXNlckFnZW50ICsgc2FsdCkuZGlnZXN0KCdoZXgnKS5zdWJzdHJpbmcoMCwgMTYpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpZW50RmluZ2VycHJpbnQocmVxOiBhbnkpOiB7IGlwSGFzaDogc3RyaW5nOyB1YUhhc2g6IHN0cmluZyB9IHtcbiAgLy8gR2V0IHJlYWwgSVAgKGNvbnNpZGVyaW5nIHByb3hpZXMpXG4gIGNvbnN0IGlwID0gcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddPy5zcGxpdCgnLCcpWzBdIHx8IFxuICAgICAgICAgICAgIHJlcS5oZWFkZXJzWyd4LXJlYWwtaXAnXSB8fCBcbiAgICAgICAgICAgICByZXEuY29ubmVjdGlvbj8ucmVtb3RlQWRkcmVzcyB8fCBcbiAgICAgICAgICAgICByZXEuc29ja2V0Py5yZW1vdGVBZGRyZXNzIHx8IFxuICAgICAgICAgICAgICcxMjcuMC4wLjEnO1xuICBcbiAgY29uc3QgdXNlckFnZW50ID0gcmVxLmhlYWRlcnNbJ3VzZXItYWdlbnQnXSB8fCAndW5rbm93bic7XG4gIFxuICByZXR1cm4ge1xuICAgIGlwSGFzaDogaGFzaElQKGlwKSxcbiAgICB1YUhhc2g6IGhhc2hVc2VyQWdlbnQodXNlckFnZW50KVxuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzYWdlU3RhdHMge1xuICBmcmVlQ2hlY2tzVXNlZDogbnVtYmVyO1xuICBwYWlkQ2hlY2tzUmVtYWluaW5nOiBudW1iZXI7XG4gIHRvdGFsQ2hlY2tzVGhpc1dlZWs6IG51bWJlcjtcbiAgaXNMaW1pdGVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNhZ2VTdGF0cyh1c2VySWQ/OiBzdHJpbmcsIGlwSGFzaD86IHN0cmluZywgdWFIYXNoPzogc3RyaW5nKTogUHJvbWlzZTxVc2FnZVN0YXRzPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KCk7XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gIFxuICAvLyBDYWxjdWxhdGUgdGhlIHN0YXJ0IG9mIHRoZSBjdXJyZW50IHdlZWsgKE1vbmRheSlcbiAgY29uc3Qgd2Vla1N0YXJ0ID0gbmV3IERhdGUobm93KTtcbiAgY29uc3QgZGF5T2ZXZWVrID0gbm93LmdldERheSgpO1xuICBjb25zdCBkYXlzVG9Nb25kYXkgPSBkYXlPZldlZWsgPT09IDAgPyA2IDogZGF5T2ZXZWVrIC0gMTsgLy8gU3VuZGF5ID0gMCwgc28gNiBkYXlzIGJhY2sgdG8gTW9uZGF5XG4gIHdlZWtTdGFydC5zZXREYXRlKG5vdy5nZXREYXRlKCkgLSBkYXlzVG9Nb25kYXkpO1xuICB3ZWVrU3RhcnQuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIFxuICBjb25zb2xlLmxvZygnR2V0dGluZyB1c2FnZSBzdGF0cyBmb3I6JywgeyB1c2VySWQsIGlwSGFzaCwgdWFIYXNoLCB3ZWVrU3RhcnQ6IHdlZWtTdGFydC50b0lTT1N0cmluZygpIH0pO1xuICBjb25zb2xlLmxvZygnVXNlcklkIHR5cGU6JywgdHlwZW9mIHVzZXJJZCwgJ1ZhbHVlOicsIHVzZXJJZCk7XG4gIFxuICAvLyBHZXQgZnJlZSBjaGVja3MgdXNlZCBpbiB0aGUgY3VycmVudCB3ZWVrXG4gIGxldCBmcmVlVXNhZ2VRdWVyeSA9IHN1cGFiYXNlXG4gICAgLmZyb20oJ3VzYWdlX2xvZ3MnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5ndGUoJ2NyZWF0ZWRfYXQnLCB3ZWVrU3RhcnQudG9JU09TdHJpbmcoKSk7XG4gIFxuICBpZiAodXNlcklkKSB7XG4gICAgLy8gRm9yIGF1dGhlbnRpY2F0ZWQgdXNlcnMsIGNvdW50IG9ubHkgZnJlZSBjaGVja3MgZm9yIHRoaXMgdXNlclxuICAgIGZyZWVVc2FnZVF1ZXJ5ID0gZnJlZVVzYWdlUXVlcnkuZXEoJ3VzZXJfaWQnLCB1c2VySWQpLmVxKCdjaGVja190eXBlJywgJ2ZyZWUnKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBGb3IgYW5vbnltb3VzIHVzZXJzLCBjb3VudCBhbGwgY2hlY2tzICh0aGV5J3JlIGFsbCBmcmVlKVxuICAgIGZyZWVVc2FnZVF1ZXJ5ID0gZnJlZVVzYWdlUXVlcnkuaXMoJ3VzZXJfaWQnLCBudWxsKTtcbiAgfVxuICBcbiAgY29uc3QgeyBkYXRhOiBmcmVlVXNhZ2UsIGVycm9yOiBmcmVlRXJyb3IgfSA9IGF3YWl0IGZyZWVVc2FnZVF1ZXJ5O1xuICBcbiAgaWYgKGZyZWVFcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGZyZWUgdXNhZ2U6JywgZnJlZUVycm9yKTtcbiAgfVxuICBcbiAgY29uc29sZS5sb2coJ0ZyZWUgdXNhZ2UgZGF0YTonLCBmcmVlVXNhZ2UpO1xuICBjb25zdCBmcmVlQ2hlY2tzVXNlZCA9IGZyZWVVc2FnZT8ubGVuZ3RoIHx8IDA7XG4gIFxuICAvLyBHZXQgcGFpZCBjaGVja3MgcmVtYWluaW5nIGZvciB1c2VyXG4gIGxldCBwYWlkQ2hlY2tzUmVtYWluaW5nID0gMDtcbiAgaWYgKHVzZXJJZCkge1xuICAgIGNvbnNvbGUubG9nKCfwn5SNIEZldGNoaW5nIHBhaWQgY2hlY2tzIGZvciB1c2VyOicsIHVzZXJJZCk7XG4gICAgY29uc3QgeyBkYXRhOiB1c2VyLCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcbiAgICAgIC5zZWxlY3QoJ3JlbWFpbmluZ19jaGVja3MnKVxuICAgICAgLmVxKCdpZCcsIHVzZXJJZClcbiAgICAgIC5zaW5nbGUoKTtcbiAgICBcbiAgICBpZiAodXNlckVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB1c2VyIHByb2ZpbGUgZm9yIHBhaWQgY2hlY2tzOicsIHVzZXJFcnJvcik7XG4gICAgICBcbiAgICAgIC8vIElmIHByb2ZpbGUgZG9lc24ndCBleGlzdCwgY3JlYXRlIGl0XG4gICAgICBpZiAodXNlckVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ/CflKcgVXNlciBwcm9maWxlIG5vdCBmb3VuZCwgY3JlYXRpbmcgb25lLi4uJyk7XG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICAgICAgcmVtYWluaW5nX2NoZWNrczogMFxuICAgICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgaWYgKGNyZWF0ZUVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgdXNlciBwcm9maWxlOicsIGNyZWF0ZUVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+UpyBVc2VyIHByb2ZpbGUgY3JlYXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBVc2VyIHByb2ZpbGUgZGF0YTonLCB1c2VyKTtcbiAgICB9XG4gICAgXG4gICAgcGFpZENoZWNrc1JlbWFpbmluZyA9IHVzZXI/LnJlbWFpbmluZ19jaGVja3MgfHwgMDtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBQYWlkIGNoZWNrcyByZW1haW5pbmc6JywgcGFpZENoZWNrc1JlbWFpbmluZyk7XG4gIH1cbiAgXG4gIC8vIEdldCB0b3RhbCBjaGVja3MgdGhpcyB3ZWVrIChmb3IgYWJ1c2UgZGV0ZWN0aW9uKVxuICBjb25zdCB7IGRhdGE6IHRvdGFsVXNhZ2UgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3VzYWdlX2xvZ3MnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5ndGUoJ2NyZWF0ZWRfYXQnLCB3ZWVrU3RhcnQudG9JU09TdHJpbmcoKSk7XG4gIFxuICBjb25zdCB0b3RhbENoZWNrc1RoaXNXZWVrID0gdG90YWxVc2FnZT8ubGVuZ3RoIHx8IDA7XG4gIFxuICAvLyBDaGVjayBpZiB1c2VyIGlzIGxpbWl0ZWQgKDMgZnJlZSBjaGVja3MgcGVyIHdlZWspXG4gIGNvbnN0IGlzTGltaXRlZCA9IGZyZWVDaGVja3NVc2VkID49IDM7XG4gIGNvbnNvbGUubG9nKCdpc0xpbWl0ZWQgY2FsY3VsYXRpb246JywgeyBmcmVlQ2hlY2tzVXNlZCwgaXNMaW1pdGVkIH0pO1xuICBcbiAgY29uc3QgcmVzdWx0ID0ge1xuICAgIGZyZWVDaGVja3NVc2VkLFxuICAgIHBhaWRDaGVja3NSZW1haW5pbmcsXG4gICAgdG90YWxDaGVja3NUaGlzV2VlayxcbiAgICBpc0xpbWl0ZWRcbiAgfTtcbiAgXG4gIGNvbnNvbGUubG9nKCdVc2FnZSBzdGF0cyByZXN1bHQ6JywgcmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ1VzYWdlKFxuICB1c2VySWQ6IHN0cmluZyB8IG51bGwsIFxuICBpcEhhc2g6IHN0cmluZywgXG4gIHVhSGFzaDogc3RyaW5nLCBcbiAgY2hlY2tUeXBlOiAnZnJlZScgfCAncGFpZCdcbik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudCgpO1xuICBcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgndXNhZ2VfbG9ncycpXG4gICAgLmluc2VydCh7XG4gICAgICB1c2VyX2lkOiB1c2VySWQgfHwgbnVsbCxcbiAgICAgIGlwX2hhc2g6IGlwSGFzaCxcbiAgICAgIHVzZXJfYWdlbnRfaGFzaDogdWFIYXNoLFxuICAgICAgY2hlY2tfdHlwZTogY2hlY2tUeXBlXG4gICAgfSk7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9nIHVzYWdlOicsIGVycm9yKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2cgdXNhZ2U6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgfVxuICBcbiAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBsb2dnZWQgdXNhZ2U6JywgeyB1c2VySWQsIGlwSGFzaCwgdWFIYXNoLCBjaGVja1R5cGUgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyOiBzdHJpbmcsIGFjdGlvbjogc3RyaW5nID0gJ2NoZWNrJyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudCgpO1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICBjb25zdCB3aW5kb3dTdGFydCA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSA2MCAqIDYwICogMTAwMCk7IC8vIDEgaG91ciB3aW5kb3dcbiAgXG4gIC8vIENoZWNrIGN1cnJlbnQgcmF0ZSBsaW1pdFxuICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdyYXRlX2xpbWl0cycpXG4gICAgLnNlbGVjdCgnKicpXG4gICAgLmVxKCdpZGVudGlmaWVyJywgaWRlbnRpZmllcilcbiAgICAuZXEoJ2FjdGlvbicsIGFjdGlvbilcbiAgICAuZ3RlKCd3aW5kb3dfc3RhcnQnLCB3aW5kb3dTdGFydC50b0lTT1N0cmluZygpKVxuICAgIC5zaW5nbGUoKTtcbiAgXG4gIGlmIChleGlzdGluZykge1xuICAgIC8vIElmIG1vcmUgdGhhbiAxMDAgY2hlY2tzIHBlciBob3VyLCBibG9jayAoaW5jcmVhc2VkIGZvciB0ZXN0aW5nKVxuICAgIGlmIChleGlzdGluZy5jb3VudCA+PSAxMDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgLy8gSW5jcmVtZW50IGNvdW50XG4gICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdyYXRlX2xpbWl0cycpXG4gICAgICAudXBkYXRlKHsgY291bnQ6IGV4aXN0aW5nLmNvdW50ICsgMSB9KVxuICAgICAgLmVxKCdpZCcsIGV4aXN0aW5nLmlkKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBDcmVhdGUgbmV3IHJhdGUgbGltaXQgcmVjb3JkXG4gICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdyYXRlX2xpbWl0cycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgYWN0aW9uLFxuICAgICAgICBjb3VudDogMSxcbiAgICAgICAgd2luZG93X3N0YXJ0OiBub3cudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gIH1cbiAgXG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGV0ZWN0QWJ1c2UoaXBIYXNoOiBzdHJpbmcsIHVhSGFzaDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KCk7XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gIFxuICAvLyBDYWxjdWxhdGUgdGhlIHN0YXJ0IG9mIHRoZSBjdXJyZW50IHdlZWsgKE1vbmRheSlcbiAgY29uc3Qgd2Vla1N0YXJ0ID0gbmV3IERhdGUobm93KTtcbiAgY29uc3QgZGF5T2ZXZWVrID0gbm93LmdldERheSgpO1xuICBjb25zdCBkYXlzVG9Nb25kYXkgPSBkYXlPZldlZWsgPT09IDAgPyA2IDogZGF5T2ZXZWVrIC0gMTsgLy8gU3VuZGF5ID0gMCwgc28gNiBkYXlzIGJhY2sgdG8gTW9uZGF5XG4gIHdlZWtTdGFydC5zZXREYXRlKG5vdy5nZXREYXRlKCkgLSBkYXlzVG9Nb25kYXkpO1xuICB3ZWVrU3RhcnQuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIFxuICAvLyBDaGVjayBmb3Igc3VzcGljaW91cyBhY3Rpdml0eSBwYXR0ZXJuc1xuICBjb25zdCB7IGRhdGE6IGlwVXNhZ2UgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3VzYWdlX2xvZ3MnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5lcSgnaXBfaGFzaCcsIGlwSGFzaClcbiAgICAuZ3RlKCdjcmVhdGVkX2F0Jywgd2Vla1N0YXJ0LnRvSVNPU3RyaW5nKCkpO1xuICBcbiAgY29uc3QgeyBkYXRhOiB1YVVzYWdlIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCd1c2FnZV9sb2dzJylcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuZXEoJ3VzZXJfYWdlbnRfaGFzaCcsIHVhSGFzaClcbiAgICAuZ3RlKCdjcmVhdGVkX2F0Jywgd2Vla1N0YXJ0LnRvSVNPU3RyaW5nKCkpO1xuICBcbiAgLy8gRmxhZyBhcyBhYnVzZSBpZjpcbiAgLy8gLSBNb3JlIHRoYW4gNTAgY2hlY2tzIGZyb20gc2FtZSBJUCB0aGlzIHdlZWsgKGluY3JlYXNlZCBmcm9tIGRhaWx5IGxpbWl0KVxuICAvLyAtIE1vcmUgdGhhbiA0MCBjaGVja3MgZnJvbSBzYW1lIHVzZXIgYWdlbnQgdGhpcyB3ZWVrIChpbmNyZWFzZWQgZnJvbSBkYWlseSBsaW1pdClcbiAgLy8gLSBNb3JlIHRoYW4gMTAgZGlmZmVyZW50IHVzZXIgYWdlbnRzIGZyb20gc2FtZSBJUCB0aGlzIHdlZWsgKGluY3JlYXNlZCBmcm9tIGRhaWx5IGxpbWl0KVxuICBjb25zdCBpcENvdW50ID0gaXBVc2FnZT8ubGVuZ3RoIHx8IDA7XG4gIGNvbnN0IHVhQ291bnQgPSB1YVVzYWdlPy5sZW5ndGggfHwgMDtcbiAgXG4gIC8vIEdldCB1bmlxdWUgdXNlciBhZ2VudHMgZm9yIHRoaXMgSVBcbiAgY29uc3QgeyBkYXRhOiB1bmlxdWVVQXMgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3VzYWdlX2xvZ3MnKVxuICAgIC5zZWxlY3QoJ3VzZXJfYWdlbnRfaGFzaCcpXG4gICAgLmVxKCdpcF9oYXNoJywgaXBIYXNoKVxuICAgIC5ndGUoJ2NyZWF0ZWRfYXQnLCB3ZWVrU3RhcnQudG9JU09TdHJpbmcoKSk7XG4gIFxuICBjb25zdCB1bmlxdWVVQUNvdW50ID0gbmV3IFNldCh1bmlxdWVVQXM/Lm1hcCgodTogYW55KSA9PiB1LnVzZXJfYWdlbnRfaGFzaCkgfHwgW10pLnNpemU7XG4gIFxuICByZXR1cm4gaXBDb3VudCA+IDUwIHx8IHVhQ291bnQgPiA0MCB8fCB1bmlxdWVVQUNvdW50ID4gMTA7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWR1Y3RQYWlkQ2hlY2sodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoKTtcbiAgXG4gIGNvbnNvbGUubG9nKCfwn5SnIERlZHVjdGluZyBwYWlkIGNoZWNrIGZvciB1c2VyOicsIHVzZXJJZCk7XG4gIFxuICAvLyBGaXJzdCBnZXQgY3VycmVudCByZW1haW5pbmdfY2hlY2tzXG4gIGNvbnN0IHsgZGF0YTogY3VycmVudFByb2ZpbGUsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgLnNlbGVjdCgncmVtYWluaW5nX2NoZWNrcycpXG4gICAgLmVxKCdpZCcsIHVzZXJJZClcbiAgICAuc2luZ2xlKCk7XG4gIFxuICBpZiAoZmV0Y2hFcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGN1cnJlbnQgcHJvZmlsZSBmb3IgZGVkdWN0aW9uOicsIGZldGNoRXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgY29uc3QgY3VycmVudENoZWNrcyA9IGN1cnJlbnRQcm9maWxlPy5yZW1haW5pbmdfY2hlY2tzIHx8IDA7XG4gIGNvbnNvbGUubG9nKCfwn5SnIEN1cnJlbnQgY2hlY2tzIGJlZm9yZSBkZWR1Y3Rpb246JywgY3VycmVudENoZWNrcyk7XG4gIFxuICBpZiAoY3VycmVudENoZWNrcyA8PSAwKSB7XG4gICAgY29uc29sZS5sb2coJ/CflKcgTm8gY2hlY2tzIHJlbWFpbmluZywgY2Fubm90IGRlZHVjdCcpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgY29uc3QgbmV3Q2hlY2tzID0gY3VycmVudENoZWNrcyAtIDE7XG4gIGNvbnNvbGUubG9nKCfwn5SnIERlZHVjdGluZyBjaGVjaywgbmV3IGNvdW50IHdpbGwgYmU6JywgbmV3Q2hlY2tzKTtcbiAgXG4gIC8vIFVwZGF0ZSB3aXRoIG5ldyB2YWx1ZVxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgLnVwZGF0ZSh7IHJlbWFpbmluZ19jaGVja3M6IG5ld0NoZWNrcyB9KVxuICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgLnNlbGVjdCgncmVtYWluaW5nX2NoZWNrcycpXG4gICAgLnNpbmdsZSgpO1xuICBcbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVkdWN0aW5nIHBhaWQgY2hlY2s6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgY29uc29sZS5sb2coJ/CflKcgU3VjY2Vzc2Z1bGx5IGRlZHVjdGVkIGNoZWNrLCBuZXcgY291bnQ6JywgZGF0YT8ucmVtYWluaW5nX2NoZWNrcyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWRkUGFpZENoZWNrcyh1c2VySWQ6IHN0cmluZywgY2hlY2tzVG9BZGQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudCgpO1xuICBcbiAgLy8gRmlyc3QgZ2V0IGN1cnJlbnQgcmVtYWluaW5nX2NoZWNrc1xuICBjb25zdCB7IGRhdGE6IGN1cnJlbnRQcm9maWxlLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgncHJvZmlsZXMnKVxuICAgIC5zZWxlY3QoJ3JlbWFpbmluZ19jaGVja3MnKVxuICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgLnNpbmdsZSgpO1xuICBcbiAgaWYgKGZldGNoRXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBjdXJyZW50IHByb2ZpbGUgZm9yIGFkZGl0aW9uOicsIGZldGNoRXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZldGNoIGN1cnJlbnQgcHJvZmlsZScpO1xuICB9XG4gIFxuICBjb25zdCBjdXJyZW50Q2hlY2tzID0gY3VycmVudFByb2ZpbGU/LnJlbWFpbmluZ19jaGVja3MgfHwgMDtcbiAgY29uc3QgbmV3Q2hlY2tzID0gY3VycmVudENoZWNrcyArIGNoZWNrc1RvQWRkO1xuICBcbiAgLy8gVXBkYXRlIHdpdGggbmV3IHZhbHVlXG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3Byb2ZpbGVzJylcbiAgICAudXBkYXRlKHsgcmVtYWluaW5nX2NoZWNrczogbmV3Q2hlY2tzIH0pXG4gICAgLmVxKCdpZCcsIHVzZXJJZCk7XG4gIFxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhZGRpbmcgcGFpZCBjaGVja3M6JywgZXJyb3IpO1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGFkZCBwYWlkIGNoZWNrcycpO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJjcnlwdG8iLCJtb2NrU3VwYWJhc2UiLCJmcm9tIiwidGFibGUiLCJzZWxlY3QiLCJjb2x1bW5zIiwiZXEiLCJjb2x1bW4iLCJ2YWx1ZSIsImd0ZSIsInNpbmdsZSIsIlByb21pc2UiLCJyZXNvbHZlIiwiZGF0YSIsImVycm9yIiwidGhlbiIsImNhbGxiYWNrIiwiaW5zZXJ0IiwidXBkYXRlIiwicmVtYWluaW5nX2NoZWNrcyIsInJhdyIsInF1ZXJ5IiwiY3JlYXRlQ2xpZW50IiwicHJvY2VzcyIsImNyZWF0ZVJlYWxDbGllbnQiLCJyZXF1aXJlIiwiY2xpZW50IiwiY29uc29sZSIsImxvZyIsImhhc2hJUCIsImlwIiwic2FsdCIsImVudiIsIklQX0hBU0hfU0FMVCIsImNyZWF0ZUhhc2giLCJkaWdlc3QiLCJzdWJzdHJpbmciLCJoYXNoVXNlckFnZW50IiwidXNlckFnZW50IiwiVUFfSEFTSF9TQUxUIiwiZ2V0Q2xpZW50RmluZ2VycHJpbnQiLCJyZXEiLCJoZWFkZXJzIiwic3BsaXQiLCJjb25uZWN0aW9uIiwicmVtb3RlQWRkcmVzcyIsInNvY2tldCIsImlwSGFzaCIsInVhSGFzaCIsImdldFVzYWdlU3RhdHMiLCJ1c2VySWQiLCJzdXBhYmFzZSIsIm5vdyIsIkRhdGUiLCJ3ZWVrU3RhcnQiLCJkYXlPZldlZWsiLCJnZXREYXkiLCJkYXlzVG9Nb25kYXkiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInNldEhvdXJzIiwidG9JU09TdHJpbmciLCJmcmVlVXNhZ2VRdWVyeSIsImlzIiwiZnJlZVVzYWdlIiwiZnJlZUVycm9yIiwiZnJlZUNoZWNrc1VzZWQiLCJsZW5ndGgiLCJwYWlkQ2hlY2tzUmVtYWluaW5nIiwidXNlciIsInVzZXJFcnJvciIsImNvZGUiLCJjcmVhdGVFcnJvciIsImlkIiwidG90YWxVc2FnZSIsInRvdGFsQ2hlY2tzVGhpc1dlZWsiLCJpc0xpbWl0ZWQiLCJyZXN1bHQiLCJsb2dVc2FnZSIsImNoZWNrVHlwZSIsInVzZXJfaWQiLCJpcF9oYXNoIiwidXNlcl9hZ2VudF9oYXNoIiwiY2hlY2tfdHlwZSIsIkVycm9yIiwibWVzc2FnZSIsImNoZWNrUmF0ZUxpbWl0IiwiaWRlbnRpZmllciIsImFjdGlvbiIsIndpbmRvd1N0YXJ0IiwiZ2V0VGltZSIsImV4aXN0aW5nIiwiY291bnQiLCJ3aW5kb3dfc3RhcnQiLCJkZXRlY3RBYnVzZSIsImlwVXNhZ2UiLCJ1YVVzYWdlIiwiaXBDb3VudCIsInVhQ291bnQiLCJ1bmlxdWVVQXMiLCJ1bmlxdWVVQUNvdW50IiwiU2V0IiwibWFwIiwidSIsInNpemUiLCJkZWR1Y3RQYWlkQ2hlY2siLCJjdXJyZW50UHJvZmlsZSIsImZldGNoRXJyb3IiLCJjdXJyZW50Q2hlY2tzIiwibmV3Q2hlY2tzIiwiYWRkUGFpZENoZWNrcyIsImNoZWNrc1RvQWRkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/usage-enhanced.ts\n");

/***/ }),

/***/ "(api)/./pages/api/usage-stats.ts":
/*!**********************************!*\
  !*** ./pages/api/usage-stats.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/usage-enhanced */ \"(api)/./lib/usage-enhanced.ts\");\n\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") return res.status(405).end(\"Method not allowed\");\n    try {\n        const { userId } = req.body;\n        console.log(\"\\uD83D\\uDCCA Usage stats API called for user:\", userId);\n        // Get client fingerprint for anonymous users\n        const { ipHash, uaHash } = (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_0__.getClientFingerprint)(req);\n        // Get usage stats for the user (authenticated or anonymous)\n        const usageStats = await (0,_lib_usage_enhanced__WEBPACK_IMPORTED_MODULE_0__.getUsageStats)(userId || null, ipHash, uaHash);\n        console.log(\"\\uD83D\\uDCCA Usage stats API returning:\", usageStats);\n        return res.status(200).json(usageStats);\n    } catch (e) {\n        console.error(\"Usage stats error:\", e);\n        return res.status(500).json({\n            error: e?.message || \"Server error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdXNhZ2Utc3RhdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDcUQ7QUFDTztBQUU3QyxlQUFlRSxRQUFRQyxHQUFtQixFQUFFQyxHQUFvQjtJQUM3RSxJQUFJRCxJQUFJRSxNQUFNLEtBQUssUUFBUSxPQUFPRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsR0FBRyxDQUFDO0lBRXRELElBQUk7UUFDRixNQUFNLEVBQUVDLE1BQU0sRUFBRSxHQUFHTCxJQUFJTSxJQUFJO1FBRTNCQyxRQUFRQyxHQUFHLENBQUMsaURBQXVDSDtRQUVuRCw2Q0FBNkM7UUFDN0MsTUFBTSxFQUFFSSxNQUFNLEVBQUVDLE1BQU0sRUFBRSxHQUFHWix5RUFBb0JBLENBQUNFO1FBRWhELDREQUE0RDtRQUM1RCxNQUFNVyxhQUFhLE1BQU1kLGtFQUFhQSxDQUFDUSxVQUFVLE1BQU1JLFFBQVFDO1FBRS9ESCxRQUFRQyxHQUFHLENBQUMsMkNBQWlDRztRQUM3QyxPQUFPVixJQUFJRSxNQUFNLENBQUMsS0FBS1MsSUFBSSxDQUFDRDtJQUM5QixFQUFFLE9BQU9FLEdBQVE7UUFDZk4sUUFBUU8sS0FBSyxDQUFDLHNCQUFzQkQ7UUFDcEMsT0FBT1osSUFBSUUsTUFBTSxDQUFDLEtBQUtTLElBQUksQ0FBQztZQUFFRSxPQUFPRCxHQUFHRSxXQUFXO1FBQWU7SUFDcEU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2xhYnVidXMtY2hlY2tlci8uL3BhZ2VzL2FwaS91c2FnZS1zdGF0cy50cz80NzliIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XHJcbmltcG9ydCB7IGdldFVzYWdlU3RhdHMgfSBmcm9tIFwiQC9saWIvdXNhZ2UtZW5oYW5jZWRcIjtcclxuaW1wb3J0IHsgZ2V0Q2xpZW50RmluZ2VycHJpbnQgfSBmcm9tIFwiQC9saWIvdXNhZ2UtZW5oYW5jZWRcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmVuZCgnTWV0aG9kIG5vdCBhbGxvd2VkJyk7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgdXNlcklkIH0gPSByZXEuYm9keTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coJ/Cfk4ogVXNhZ2Ugc3RhdHMgQVBJIGNhbGxlZCBmb3IgdXNlcjonLCB1c2VySWQpO1xyXG4gICAgXHJcbiAgICAvLyBHZXQgY2xpZW50IGZpbmdlcnByaW50IGZvciBhbm9ueW1vdXMgdXNlcnNcclxuICAgIGNvbnN0IHsgaXBIYXNoLCB1YUhhc2ggfSA9IGdldENsaWVudEZpbmdlcnByaW50KHJlcSk7XHJcbiAgICBcclxuICAgIC8vIEdldCB1c2FnZSBzdGF0cyBmb3IgdGhlIHVzZXIgKGF1dGhlbnRpY2F0ZWQgb3IgYW5vbnltb3VzKVxyXG4gICAgY29uc3QgdXNhZ2VTdGF0cyA9IGF3YWl0IGdldFVzYWdlU3RhdHModXNlcklkIHx8IG51bGwsIGlwSGFzaCwgdWFIYXNoKTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coJ/Cfk4ogVXNhZ2Ugc3RhdHMgQVBJIHJldHVybmluZzonLCB1c2FnZVN0YXRzKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih1c2FnZVN0YXRzKTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VzYWdlIHN0YXRzIGVycm9yOicsIGUpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGU/Lm1lc3NhZ2UgfHwgJ1NlcnZlciBlcnJvcicgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuIl0sIm5hbWVzIjpbImdldFVzYWdlU3RhdHMiLCJnZXRDbGllbnRGaW5nZXJwcmludCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJlbmQiLCJ1c2VySWQiLCJib2R5IiwiY29uc29sZSIsImxvZyIsImlwSGFzaCIsInVhSGFzaCIsInVzYWdlU3RhdHMiLCJqc29uIiwiZSIsImVycm9yIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/usage-stats.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fusage-stats&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cusage-stats.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();